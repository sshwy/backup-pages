<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>字符串导论 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">字符串导论</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2020年3月2日星期一下午4点34分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2020年3月2日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 2,915 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> <a class="directory" href="/directory/String/">字符串 </a><span class="icon smallarrow"></span> 当前文章</div><div class="post-tags"><span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Notes/">Notes</a></span></div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本定义与符号表示"><span class="toc-number">1.</span> <span class="toc-text">基本定义与符号表示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#周期与-Border"><span class="toc-number">2.</span> <span class="toc-text">周期与 Border</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#周期引理"><span class="toc-number">2.1.</span> <span class="toc-text">周期引理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串匹配"><span class="toc-number">2.2.</span> <span class="toc-text">字符串匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Border-的结构"><span class="toc-number">2.3.</span> <span class="toc-text">Border 的结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#子串-Border-查询"><span class="toc-number">2.4.</span> <span class="toc-text">子串 Border 查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Case-1"><span class="toc-number">2.4.1.</span> <span class="toc-text">Case 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Case-2"><span class="toc-number">2.4.2.</span> <span class="toc-text">Case 2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文献"><span class="toc-number">3.</span> <span class="toc-text">参考文献</span></a></li></ol></div><hr></div><div class="post-content"><p>本文将讲述关于字符串的基本概念以及延伸的推论。</p><p>注：如无特殊说明，通常情况下<script type="math/tex">[l,r]</script>表示整数区间（即<script type="math/tex">\{l,l+1,\cdots,r\}</script>）而不是实数区间。类似地，<script type="math/tex">[l,r)=\{l,l+1,\cdots,r-1\}</script>。</p><h2><a id="基本定义与符号表示" href="#基本定义与符号表示" class="headerlink" title="基本定义与符号表示"></a>基本定义与符号表示</h2><p>字符串：字符串通常使用单个字母表示，如<script type="math/tex">S</script>，<script type="math/tex">s</script>，<script type="math/tex">t</script>。</p><p>长度：字符串<script type="math/tex">S</script>的<strong>长度（Length）</strong>表示为<script type="math/tex">|S|</script>。</p><p>字符：字符串<script type="math/tex">S</script>从左到右第<script type="math/tex">i</script>个字符记为<script type="math/tex">S[i]</script>。如果没有特殊说明，通常是 1 作为起始下标。</p><p>子串：<script type="math/tex">S</script>中第<script type="math/tex">l</script>个字符到第<script type="math/tex">r</script>个字符构成的串称作<script type="math/tex">S</script>的<strong>子串（Substring）</strong>，记作<script type="math/tex">S[l,r]</script>。其中<script type="math/tex">1\le l,r\le |S|</script>。</p><p>前缀：如果<script type="math/tex">l=1</script>，那么这个子串也被称作<script type="math/tex">S</script>的<strong>前缀（Prefix）</strong>。</p><p>后缀：如果<script type="math/tex">r=|S|</script>，那么这个子串也被称为<script type="math/tex">S</script>的<strong>后缀（Suffix）</strong>。</p><h2><a id="周期与-Border" href="#周期与-Border" class="headerlink" title="周期与 Border"></a>周期与 Border</h2><p>Border：若对于<script type="math/tex">x(1\le x&lt; |S|)</script>满足<script type="math/tex">S[1,x]=S[|S|-x+1,|S|]</script>，那么称<script type="math/tex">S[1,x]</script>是<script type="math/tex">S</script>的<strong>Border</strong>（也称<script type="math/tex">x</script>是<script type="math/tex">S</script>的 Border）。</p><p>周期：若对于<script type="math/tex">x(1\le x\le |S|)</script>，使得<script type="math/tex">\forall i\in[1,|S|-x],S[i]=S[i+x]</script>，那么称<script type="math/tex">S[1,x]</script>是<script type="math/tex">S</script>的<strong>周期（Period）</strong>，也称<script type="math/tex">x</script>是<script type="math/tex">S</script>的周期。</p><p>记<script type="math/tex">S</script>的<strong>最小周期</strong>为<script type="math/tex">\text{per}(S)</script>。</p><p><img src="../../images/string-basics-1.png" width="400px"></p><p>每个周期（除了<script type="math/tex">x=|S|</script>的周期）都对应了一个 Border。具体地，周期<script type="math/tex">x</script>对应了 Border<script type="math/tex">|S|-x</script>。</p><p>求所有 Border：KMP 算法不停跳 Fail 指针即可。</p><h3><a id="周期引理" href="#周期引理" class="headerlink" title="周期引理"></a>周期引理</h3><p><strong>弱周期引理（Weak Periodicity Lemma）</strong>：若<script type="math/tex">p,q</script>都是<script type="math/tex">S</script>的周期且<script type="math/tex">p+q\le |S|</script>，则<script type="math/tex">\gcd(p,q)</script>也是<script type="math/tex">S</script>的周期。</p><p>证明：不妨设<script type="math/tex">p&lt;q</script>。设<script type="math/tex">d=q-p</script>。<script type="math/tex">\forall i\in[1,|S|-d]</script>，发现<script type="math/tex">i+q\le |S|</script>和<script type="math/tex">i-p\ge 1</script>一定满足其中一个。因此可以退出<script type="math/tex">S[i]=S[i+d]</script>。即<script type="math/tex">d</script>是<script type="math/tex">S</script>的周期。那么辗转相减即可证明。</p><p><strong>周期引理（Periodicity Lemma）</strong>：若<script type="math/tex">p,q</script>都是<script type="math/tex">S</script>的周期且<script type="math/tex">p+q-\gcd(p,q)\le |S|</script>，则<script type="math/tex">\gcd(p,q)</script>也是<script type="math/tex">S</script>的周期。</p><h3><a id="字符串匹配" href="#字符串匹配" class="headerlink" title="字符串匹配"></a>字符串匹配</h3><p><strong>引理 1（等差数列引理）</strong>：字符串<script type="math/tex">S,T</script>满足<script type="math/tex">2|S|\ge |T|</script>，则<script type="math/tex">S</script>在<script type="math/tex">T</script>中的所有匹配位置构成一个等差数列。</p><p>证明：</p><p><img src="../../images/string-basics-4.png" width="600px"></p><p>考虑其中的 3 次匹配：第 1 次，第 2 次和最后一次。设它们的间距分别是<script type="math/tex">d,q</script>。</p><p>根据周期的定义得，<script type="math/tex">d,q</script>都是<script type="math/tex">S</script>的周期。</p><p>由于<script type="math/tex">2|S|\ge |T|</script>，因此<script type="math/tex">d+q\le |S|</script>。因此根据<strong>周期引理</strong>，<script type="math/tex">\gcd(d,q)</script>也是<script type="math/tex">|S|</script>的周期。</p><p>因此不难证明，（设第一次匹配的位置是<script type="math/tex">x_0</script>）<script type="math/tex">x_0,x_0+\gcd(d,q),\cdots,x_0+d+q</script>都是匹配位置。即构成一个公差为<script type="math/tex">\gcd(d,q)</script>的等差数列。更严格地说，是构成一个公差为<script type="math/tex">d</script>的等差数列。</p><p><strong>引理 2（公差引理）</strong>：字符串<script type="math/tex">S,T</script>满足<script type="math/tex">2|S|\ge |T|</script>，则<script type="math/tex">S</script>在<script type="math/tex">T</script>中的所有匹配位置构成一个等差数列。若等差数列至少有 3 项，则其公差<script type="math/tex">d</script>等于<script type="math/tex">S</script>的<strong>最小周期</strong><script type="math/tex">\text{per}(S)</script>。此时易知<script type="math/tex">2d\le |S|</script>。</p><p>仅含两项时不一定成立，如<script type="math/tex">S=\text{aabaa},T=\text{aabaaabaa}</script>。</p><h3><a id="Border-的结构" href="#Border-的结构" class="headerlink" title="Border 的结构"></a>Border 的结构</h3><p><strong>引理（等差数列引理）</strong>：字符串<script type="math/tex">S</script>的所有长度不小于<script type="math/tex">\frac{|S|}{2}</script>的 Border 的长度构成等差数列。</p><p>证明：</p><p><img src="../../images/string-basics-5.png" width="600px"></p><p>我们知道每个周期都对应一个 Border。而长度不小于<script type="math/tex">\frac{|S|}{2}</script>的 Border 对应的周期满足<strong>周期引理</strong>。因此周期是等差数列，则得证。</p><p>上述引理刻画了长度不小于<script type="math/tex">\frac{|S|}{2}</script>的 Border 的结构。那么对于长度更小的 Border 呢？</p><p>我们将<script type="math/tex">S</script>的所有 Border 按长度<script type="math/tex">x</script>分类，有两种情况：</p><ol><li><script type="math/tex">x\in[2^{i-1},2^i)</script>，其中<script type="math/tex">2^i-1&lt;|S|</script>；</li><li><script type="math/tex">x\in[2^k,|S|)</script>，其中<script type="math/tex">2^k\ge \frac{|S|}{2}</script>。</li></ol><p>对于第二种情况，我们使用上述引理即可。那么考虑第一种情况：</p><p><img src="../../images/string-basics-6.png" width="700px"></p><p>容易证明，如果存在 Border 的长度在<script type="math/tex">[2^{i-1},2^i)</script>，那么对于<script type="math/tex">S[1,2^i]</script>使用上述引理即可证明，<script type="math/tex">[2^{i-1},2^i)</script>中的 Border 也构成等差数列。</p><p>推论：字符串<script type="math/tex">S</script>的所有 Border 按长度排序后可以分成<script type="math/tex">O(\log_2|S|)</script>段，使得每一段都是等差数列。</p><h3><a id="子串-Border-查询" href="#子串-Border-查询" class="headerlink" title="子串 Border 查询"></a>子串 Border 查询</h3><blockquote><p>给出长度为<script type="math/tex">n</script>的字符串<script type="math/tex">S</script>，<script type="math/tex">q</script>次询问形如<script type="math/tex">(l,r)</script>，求<script type="math/tex">S[l,r]</script>的子串的所有 Border（等价于周期），用<script type="math/tex">O(\log_2n)</script>个等差数列的形式表示。</p></blockquote><p>对于询问<script type="math/tex">S[l,r]</script>，设<script type="math/tex">t=S[l,r],m=|t|</script>。仍然按照 Border 长度分成两类：</p><ol><li><script type="math/tex">x\in[2^{i-1},2^i)</script>，其中<script type="math/tex">2^i-1&lt;m</script>。</li><li><script type="math/tex">x\in[2^i,m)</script>，其中<script type="math/tex">2^{i}\ge \frac{m}{2}</script>。</li></ol><h4><a id="Case-1" href="#Case-1" class="headerlink" title="Case 1"></a>Case 1</h4><p><script type="math/tex">x\in[2^{i-1},2^i)</script>，其中<script type="math/tex">2^i-1&lt;m</script>。</p><p><img src="../../images/string-basics-2.png" width="700px"></p><p>如图的<script type="math/tex">x</script>是一个满足要求的 Border。那么容易发现<script type="math/tex">t[1,2^{i-1}]</script>是<script type="math/tex">x</script>的前缀，而<script type="math/tex">t[m-2^{i-1}+1,m]</script>是<script type="math/tex">x</script>的后缀。</p><p>因此，不妨求出<script type="math/tex">t[1,2^{i-1}]</script>在<script type="math/tex">t[m-2^i+1,m]</script>中匹配的位置的集合<script type="math/tex">A</script>，以及<script type="math/tex">t[m-2^{i-1}+1,m]</script>在<script type="math/tex">t[1,2^i]</script>中匹配的位置的集合<script type="math/tex">B</script>。把<script type="math/tex">A</script>做一下翻转和移位之后与<script type="math/tex">B</script>取交集就是我们要求的了（事实上也是等差数列的交）。</p><p>因此我们的问题转化为：</p><blockquote><p>询问子串<script type="math/tex">S[a,a+2^{j-1}-1]</script>在<script type="math/tex">S[b,b+2^j-1]</script>中匹配的位置集合（等差数列形式）。</p></blockquote><p>显然我们只需要求出它匹配的第一次，第二次和最后一次即可。换言之问题转化为</p><blockquote><p>询问子串<script type="math/tex">S[a,a+2^{j-1}-1]</script>在位置<script type="math/tex">x</script>后匹配的第一个位置 / 在<script type="math/tex">x</script>前匹配的最后一个位置。</p></blockquote><p>用<script type="math/tex">R(a,j)</script>表示子串<script type="math/tex">S[a,a+2^{j}-1]</script>，即长度为 2 的幂的子串。这类子串的个数是<script type="math/tex">O(n\log_2n)</script>的。因此我们求出它们的字典序排名，把排名相同的放一起按照出现位置排序。然后询问的时候在这个序列上二分即可。排序的过程和后缀数组构建的过程类似。</p><p>而且由于长度不同的子串排名一定不同，因此我们可以构建<script type="math/tex">O(\log_2n)</script>个序列（相当于是把后缀数组的构建过程记录下来）来处理询问。</p><p>那么求出了<script type="math/tex">A</script>和<script type="math/tex">B</script>，如何求<script type="math/tex">A</script>和<script type="math/tex">B</script>的交集？也就是求两个等差数列的交集。</p><p>如果公差相等那么容易<script type="math/tex">O(1)</script>求交集。</p><p>引理：四个字符串<script type="math/tex">x_1,x_2,y_1,y_2</script>满足<script type="math/tex">|x_1|=|y_1|\ge |x_2|=|y_2|</script>，且<script type="math/tex">x_1</script>在<script type="math/tex">y_2y_1</script>中匹配至少 3 次，<script type="math/tex">y_1</script>在<script type="math/tex">x_1x_2</script>中匹配至少 3 次，则<script type="math/tex">\text{per}(x_1)=\text{per}(y_1)</script>，即最小周期相等。</p><p><img src="../../images/string-basics-3.png" width="600px"></p><p>反证：不妨设<script type="math/tex">\text{per}(x_1)&gt;\text{per}(y_1)</script>。</p><p>设<script type="math/tex">x_1</script>的最后一次匹配与<script type="math/tex">y_1</script>的交是<script type="math/tex">z</script>。则<script type="math/tex">\text{per}(z)=\text{per}(x_1)</script>。</p><p>由<strong>字符串匹配的公差引理</strong>，<script type="math/tex">|z|\ge 2\text{per}(z)&gt;\text{per}(x_1)+\text{per}(y_1)</script>。</p><p>因此<script type="math/tex">\gcd(\text{per}(x_1),\text{per}(y_1))</script>也是<script type="math/tex">z</script>的周期。但<script type="math/tex">\gcd(\text{per}(x_1),\text{per}(y_1))&lt;\text{per}(z)</script>，矛盾。</p><p>因此我们证明了<script type="math/tex">A</script>和<script type="math/tex">B</script>如果是两个等差数列且长度超过 3，那么公差一定相等。因此求交集的复杂度是<script type="math/tex">O(1)</script>的。</p><p>综上，我们可以在<script type="math/tex">O(\log_2n)</script>的时间内处理<script type="math/tex">x\in[2^{i-1},2^i)</script>的情况。</p><h4><a id="Case-2" href="#Case-2" class="headerlink" title="Case 2"></a>Case 2</h4><p><script type="math/tex">x\in[2^i,n)</script>，其中<script type="math/tex">2^{i}\ge \frac{m}{2}</script>。</p><p>即求长度不小于<script type="math/tex">2^i</script>的 Border 集合。与 Case 1 做法相同。</p><p>综上，该算法空间复杂度<script type="math/tex">O(n\log_2n)</script>，时间复杂度<script type="math/tex">O(n\log_2n+q\log_2^2n)</script>。</p><p>习题：<a target="_blank" rel="noopener" href="https://codeforces.com/gym/100962">2015-2016 Petrozavodsk Winter Training Camp, Moscow SU Trinity Contest : D Deep Purple</a> <a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/gym100962d.cpp">代码</a></p><h2><a id="参考文献" href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>字符串算法选讲，金策，清华大学交叉信息研究院，February 3, 2017</p></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2020年3月2日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/Gao/part-2/">高爸的杂题练习 2</a></div><div class="prev-post"><a href="/Codeforces/part-1/">Codeforces 题目选讲 1 </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>