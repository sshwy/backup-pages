<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>AC 自动机入门 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">AC 自动机入门</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2023年5月4日星期四晚上11点08分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2023年5月4日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 1,490 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> <a class="directory" href="/directory/String/">字符串 </a><span class="icon smallarrow"></span> 当前文章</div><div class="post-tags"><span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Notes/">Notes</a></span> <span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Automaton/">Automaton</a></span></div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#字典树模型"><span class="toc-number">1.</span> <span class="toc-text">字典树模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AC-自动机模型"><span class="toc-number">2.</span> <span class="toc-text">AC 自动机模型</span></a></li></ol></div><hr></div><div class="post-content"><p>发现了一种 AC 自动机的科学讲法，能够更准确地描述自动机中的数学模型和代码中的对象之间的关系。</p><h2><a id="字典树模型" href="#字典树模型" class="headerlink" title="字典树模型"></a>字典树模型</h2><p>假设有<script type="math/tex">m</script>个字符串<script type="math/tex">s_1, \ldots, s_m</script>，字符集为<script type="math/tex">\Sigma</script>，这些字符串构成的字典树为<script type="math/tex">T = (Q_T, \delta_T)</script>。其中<script type="math/tex">Q_T</script>表示字典树的所有状态，即所有的结点，而<script type="math/tex">\delta_T: Q_T\times \Sigma \to Q_T</script>表示字典树的转移函数，即转移边。</p><p>考虑到任意<script type="math/tex">q \in Q_T</script>都唯一对应一个字符串，我们也认为<script type="math/tex">Q_T</script>是一个字符串集合。</p><h2><a id="AC-自动机模型" href="#AC-自动机模型" class="headerlink" title="AC 自动机模型"></a>AC 自动机模型</h2><p>对<script type="math/tex">T</script>构建的 AC 自动机可以表示为<script type="math/tex">A = (Q_A, \delta_A)</script>。</p><p>任意<script type="math/tex">q_T \in Q_T</script>，与<script type="math/tex">q_A \in Q_A</script>唯一对应，<script type="math/tex">q_A</script>定义为<script type="math/tex">Q_T</script>中所有<script type="math/tex">q_T</script>的后缀（包括<script type="math/tex">q_T</script>）形成的字符串集合。也就是说<script type="math/tex">Q_A</script>是一个字符串集簇。不妨记这个双射为<script type="math/tex">\sigma: Q_T \to Q_A</script>，<script type="math/tex">\sigma q_T = q_A</script>。</p><p><script type="math/tex">\delta_A: Q_A\times \Sigma \to Q_A</script>是 AC 自动机的转移函数。对于<script type="math/tex">q \in Q_A</script>，<script type="math/tex">c \in \Sigma</script>，假设<script type="math/tex">q = \{ s_1, \ldots, s_t \}</script>（<script type="math/tex">s_i \in Q_T</script>且<script type="math/tex">s_i</script>是<script type="math/tex">s_{i + 1}</script>的后缀）。若存在最大的<script type="math/tex">k</script>使得<script type="math/tex">\delta_T(s_k, c)</script>存在，那么<script type="math/tex">\delta_A(q, c) \triangleq \sigma\delta_T(s_k, c)</script>（否则不定义<script type="math/tex">\delta_A(q, c)</script>）。</p><p>要求出<script type="math/tex">\delta_A</script>，我们需要一个辅助函数<script type="math/tex">f: Q_T\to Q_T</script>。对于<script type="math/tex">\sigma s_t = \{ s_1, \ldots, s_t \} \in Q_A</script>，<script type="math/tex">f(s_t) \triangleq s_{t - 1}</script>。这也是所谓的失配指针。有了<script type="math/tex">f</script>，我们就可以<strong>观察到</strong><script type="math/tex">q</script>。</p><p><strong>引理 1</strong>：设<script type="math/tex">\sigma \delta_T(s, c) = \{s_1c, s_2c, \ldots, s_tc\}</script>（<script type="math/tex">s_t = s</script>），那么<script type="math/tex">\{s_1, \ldots, s_t\} \subseteq \sigma s</script>。</p><p>证明：不是所有的<script type="math/tex">\hat{s} \in \sigma s</script>都存在<script type="math/tex">\delta_T(\hat{s}, c)</script>。</p><p><strong>断言 1</strong>：<script type="math/tex">\forall c\in \Sigma, s \in Q_T</script>，若<script type="math/tex">\delta_T(s, c)</script>存在，那么<script type="math/tex">\sigma f(\delta_T(s, c)) = \delta_A(f( s), c)</script>。</p><p>证明：由引理 1，可以发现<script type="math/tex">\sigma f( \delta_T(s, c))</script>末尾去掉<script type="math/tex">c</script>得到的集合<script type="math/tex">\subseteq \sigma f(s)</script>。结合<script type="math/tex">\delta_A</script>的定义，在<script type="math/tex">\sigma f(s)</script>中最大的<script type="math/tex">k</script>使得<script type="math/tex">\delta_T(s_k, c)</script>存在，一定也是<script type="math/tex">\sigma f(\delta_T(s, c))</script>中最大的<script type="math/tex">k</script>，那么一定有<script type="math/tex">\delta_T(s_k, c) = f(\delta_T(s, c))</script>。</p><p><strong>断言 2</strong>：<script type="math/tex">\forall c\in \Sigma</script>：</p><script type="math/tex;mode=display">\delta_A(\sigma s, c) =
\begin{cases}
\delta_T(s, c) & \text{If exists}\\
\delta_A(\sigma f(s), c) & \text{Otherwise}
\end{cases}</script><p>证明：由<script type="math/tex">\delta_A</script>定义和<script type="math/tex">f</script>定义。</p><p>根据上述断言可以得出 AC 自动机的代码实现：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">AC</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> tr<span class="token punctuation">[</span>SZ<span class="token punctuation">]</span><span class="token punctuation">[</span>ALP<span class="token punctuation">]</span><span class="token punctuation">,</span> fail<span class="token punctuation">[</span>SZ<span class="token punctuation">]</span><span class="token punctuation">,</span> tot<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> tot <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">new_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
  <span class="token keyword">int</span> <span class="token function">new_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token operator">++</span>tot<span class="token punctuation">,</span> fail<span class="token punctuation">[</span>tot<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">memset</span><span class="token punctuation">(</span>tr<span class="token punctuation">[</span>tot<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>tr<span class="token punctuation">[</span>tot<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tot<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
  <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">*</span>s<span class="token punctuation">;</span> <span class="token operator">++</span>s<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token operator">*</span>s <span class="token operator">-</span> <span class="token char">'a'</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tr<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span> tr<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">new_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      u <span class="token operator">=</span> tr<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">int</span> q<span class="token punctuation">[</span>SZ<span class="token punctuation">]</span><span class="token punctuation">,</span> ql<span class="token punctuation">,</span> qr<span class="token punctuation">;</span> <span class="token comment">// q里就是BFS序</span>
  <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    ql <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> qr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">FOR</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ALP <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>tr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> q<span class="token punctuation">[</span><span class="token operator">++</span>qr<span class="token punctuation">]</span> <span class="token operator">=</span> tr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>ql <span class="token operator">&lt;=</span> qr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">int</span> u <span class="token operator">=</span> q<span class="token punctuation">[</span>ql<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token function">FOR</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ALP <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tr<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span> fail<span class="token punctuation">[</span>tr<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> tr<span class="token punctuation">[</span>fail<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token operator">++</span>qr<span class="token punctuation">]</span> <span class="token operator">=</span> tr<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> tr<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> tr<span class="token punctuation">[</span>fail<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2023年5月4日 第2次修订</li><li class="post-history-item">2020年12月28日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/Math/Linear-Algbra/Basis/">线性基学习笔记</a></div><div class="prev-post"><a href="/Data-Preprocess/">AI 系统速通笔记之数据预处理 </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>