<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>字符串复习与进阶 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">字符串复习与进阶</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2019年12月7日星期六中午12点18分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2019年12月7日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 1,813 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> <a class="directory" href="/directory/String/">字符串 </a><span class="icon smallarrow"></span> 当前文章</div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#JSOI2007-字符加密"><span class="toc-number">1.</span> <span class="toc-text">JSOI2007 字符加密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Luogu2870-Best-Cow-Line"><span class="toc-number">2.</span> <span class="toc-text">Luogu2870 Best Cow Line</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CF30-E-Tricky-and-Clever-Password"><span class="toc-number">3.</span> <span class="toc-text">CF30 E Tricky and Clever Password</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CF873-F-Forbidden-Indices"><span class="toc-number">4.</span> <span class="toc-text">CF873 F Forbidden Indices</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CF547-E-Mike-and-Friends"><span class="toc-number">5.</span> <span class="toc-text">CF547 E Mike and Friends</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NOI2018-你的名字"><span class="toc-number">6.</span> <span class="toc-text">NOI2018 你的名字</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一部分"><span class="toc-number">6.1.</span> <span class="toc-text">第一部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二部分"><span class="toc-number">6.2.</span> <span class="toc-text">第二部分</span></a></li></ol></li></ol></div><hr></div><div class="post-content"><h2><a id="JSOI2007-字符加密" href="#JSOI2007-字符加密" class="headerlink" title="JSOI2007 字符加密"></a>JSOI2007 字符加密</h2><p>把字符串倍长，求后缀数组后把前一半后缀对应的位置按序输出即可。</p><p>即使字符串有循环节也是不要紧的。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/luogu/4051.cpp">代码</a></p><h2><a id="Luogu2870-Best-Cow-Line" href="#Luogu2870-Best-Cow-Line" class="headerlink" title="Luogu2870 Best Cow Line"></a>Luogu2870 Best Cow Line</h2><p>如果首尾字符不同就可以直接选择；如果相同，我们就比较这个前缀和后缀的字典序大小。可以证明这样是最优的。</p><p>那么把这个串反过来在后面接上，然后中间插入一个分隔符，建立后缀数组即可。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/luogu/2870.cpp">代码</a></p><h2><a id="CF30-E-Tricky-and-Clever-Password" href="#CF30-E-Tricky-and-Clever-Password" class="headerlink" title="CF30 E Tricky and Clever Password"></a>CF30 E Tricky and Clever Password</h2><p>我们考虑枚举中间点，manacher 计算最长回文串，那么整个串就划分为了<script type="math/tex">A+B+C</script>，其中<script type="math/tex">B</script>是回文串。那么问题就转化为了<script type="math/tex">A</script>的前缀与<script type="math/tex">R(C)</script>的 LCP。<script type="math/tex">R(S)</script>表示 S 的反串。那么我们就把原串倒过来，求出每个前缀与反串前缀的匹配长度（KMP），然后做前缀 Max 即可。</p><p>时间复杂度<script type="math/tex">O(n)</script>。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/30e.cpp">代码</a></p><h2><a id="CF873-F-Forbidden-Indices" href="#CF873-F-Forbidden-Indices" class="headerlink" title="CF873 F Forbidden Indices"></a>CF873 F Forbidden Indices</h2><p>建立 SAM 后，把没有被禁止的点加 1 的贡献，然后 fail 树上做前缀和就可以统计答案了。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/873f.cpp">代码</a></p><h2><a id="CF547-E-Mike-and-Friends" href="#CF547-E-Mike-and-Friends" class="headerlink" title="CF547 E Mike and Friends"></a>CF547 E Mike and Friends</h2><p>题意：有<script type="math/tex">n</script>个串<script type="math/tex">s_1,\cdots,s_i</script>。定义<script type="math/tex">f(i,j)</script>表示<script type="math/tex">s_i</script>在<script type="math/tex">s_j</script>里出现的次数。有<script type="math/tex">q</script>次询问，每次询问<script type="math/tex">l,r,k</script>，问<script type="math/tex">\sum_{i=l}^r f(k,i)</script>。</p><p><script type="math/tex">n\le 2\times 10^5,q\le 5\times 10^5,\sum |s_i|\le 2\times 10^5</script>。</p><p>考虑建立广义 sam，在插入一个串的时候在经过的所有结点上打上这个串的标记，表示这些状态以及它们在 fail 树上的祖先状态是这个串的子串。</p><p>那么在 fail 树上向上合并后，我们就得到了每个状态是哪些串的子串。那么询问就可以处理了。</p><p>使用线段树维护标记，线段树合并。复杂度<script type="math/tex">O(|\Sigma|\sum |s_i|\log_2n+q\log_2n)</script>。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/547e.cpp">代码</a></p><h2><a id="NOI2018-你的名字" href="#NOI2018-你的名字" class="headerlink" title="NOI2018 你的名字"></a>NOI2018 你的名字</h2><blockquote><p>给出一个字符串<script type="math/tex">S</script>，每次询问<script type="math/tex">(T,l,r)</script>，问所有<script type="math/tex">T</script>的本质不同的子串中，不在<script type="math/tex">S[l,r]</script>中出现的子串有多少个。</p><p><script type="math/tex">|S|\le 5\times 10^5,\sum |T|\le 10^6</script>。</p></blockquote><h3><a id="第一部分" href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h3><p>首先考虑<script type="math/tex">l=1,r=|S|</script>怎么做。</p><p>我们建立<script type="math/tex">T</script>的 SAM 来将相同的子串归到一个状态里。</p><p>记<script type="math/tex">l(i)</script>表示<script type="math/tex">T[1,i]</script>的后缀与<script type="math/tex">S</script>的子串匹配的最长长度。对于<script type="math/tex">T</script>的 SAM 中的状态<script type="math/tex">x</script>，记录<script type="math/tex">pos(x)</script>表示这个状态在<script type="math/tex">T</script>中结尾的位置（可能有多个位置，选择任意即可）。记<script type="math/tex">L(x)</script>表示<script type="math/tex">x</script>这个状态的长度（即<script type="math/tex">len(x)</script>）。</p><p>那么<script type="math/tex">l(pos(x))</script>得到就是<script type="math/tex">x</script>这个状态与<script type="math/tex">S</script>匹配的最长长度。那么这个状态中不与<script type="math/tex">S</script>匹配的部分就是<script type="math/tex">L(x)-\max(L(fail(x)),l(pos(x)))</script>。于是答案就是</p><script type="math/tex;mode=display">\sum_x \max(L(x)-\max(L(fail(x)),l(pos(x))),0)</script><h3><a id="第二部分" href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h3><p>接下来考虑<script type="math/tex">l,r</script>任意的情况。那么<script type="math/tex">l(i)</script>表示的就是<script type="math/tex">T[1,i]</script>的后缀与<script type="math/tex">S[l,r]</script>的子串匹配的最长长度。如果求出了<script type="math/tex">l(i)</script>那么我们就可以根据上面的式子求答案了。</p><p>我们考虑在<script type="math/tex">S</script>的 SAM 接受<script type="math/tex">T</script>的时候计算<script type="math/tex">l(i)</script>。具体地，记录一个<script type="math/tex">cur</script>表示当前与<script type="math/tex">S[l,r]</script>匹配的长度。每次我们尝试接受<script type="math/tex">T[i]</script>：</p><ul><li>如果当前状态的后继状态<script type="math/tex">tr(x,T_i)</script>中存在与<script type="math/tex">T[i-cur,i]</script>匹配且包含于<script type="math/tex">S[l,r]</script>的状态，那么就接受<script type="math/tex">T_i</script>并转移到后继状态，让<script type="math/tex">cur</script>自増，且<script type="math/tex">l(i)\gets cur</script>。</li><li>否则我们让<script type="math/tex">cur</script>自减并再次检查是否存在匹配的状态。</li><li>如果<script type="math/tex">cur=L(fail(x))</script>那么就跳转到<script type="math/tex">fail(x)</script>状态。</li></ul><p>如何判断当前状态的后继状态<script type="math/tex">tr(x,T_i)</script>中是否存在与<script type="math/tex">T[i-cur,i]</script>匹配且包含于<script type="math/tex">S[l,r]</script>的状态？对于每一个 SAM 上的状态<script type="math/tex">x</script>记录一个集合<script type="math/tex">Q(x)</script>表示<script type="math/tex">x</script>所代表的子串在<script type="math/tex">S</script>中出现的位置右端点的集合（即 Right 集合）。那么我们查询<script type="math/tex">Q(x)</script>中是否存在区间<script type="math/tex">[l+cur,r]</script>里的元素，就可以判断是否存在与<script type="math/tex">T[i-cur,i]</script>匹配且包含于<script type="math/tex">S[l,r]</script>的状态。</p><p>使用线段树维护<script type="math/tex">Q(x)</script>即可，合并的时候使用线段树合并即可。</p><p>时间复杂度<script type="math/tex">O(|S|(|\Sigma|+\log_2|S|)+\sum |T||\Sigma|)</script>。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/luogu/4770.cpp">代码</a></p></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2019年12月7日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/Math/Game-Theory/">博弈论习题集</a></div><div class="prev-post"><a href="/IOI2020hw/AGC-part-5/">IOI2020 国家集训队作业小结 5 </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>