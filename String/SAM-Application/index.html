<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>SAM 应用 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">SAM 应用</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2021年2月11日星期四中午12点26分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2021年2月11日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 1,803 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> <a class="directory" href="/directory/String/">字符串 </a><span class="icon smallarrow"></span> 当前文章</div><div class="post-tags"><span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Automaton/">Automaton</a></span> <span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/SAM/">SAM</a></span> <span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Suffix-Tree/">Suffix-Tree</a></span></div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#A-简单应用"><span class="toc-number">1.</span> <span class="toc-text">A 简单应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#两个后缀-LCP"><span class="toc-number">1.1.</span> <span class="toc-text">两个后缀 LCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#本质不同的子串个数"><span class="toc-number">1.2.</span> <span class="toc-text">本质不同的子串个数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字典序第-k-小子串"><span class="toc-number">1.3.</span> <span class="toc-text">字典序第 k 小子串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#匹配同构串"><span class="toc-number">1.4.</span> <span class="toc-text">匹配同构串</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#B-进阶套路"><span class="toc-number">2.</span> <span class="toc-text">B 进阶套路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#B1"><span class="toc-number">2.1.</span> <span class="toc-text">B1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B2"><span class="toc-number">2.2.</span> <span class="toc-text">B2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B3"><span class="toc-number">2.3.</span> <span class="toc-text">B3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B4"><span class="toc-number">2.4.</span> <span class="toc-text">B4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B5-线段树维护-Right-集合"><span class="toc-number">2.5.</span> <span class="toc-text">B5 线段树维护 Right 集合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C"><span class="toc-number">3.</span> <span class="toc-text">C</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HEOI2016-字符串"><span class="toc-number">3.1.</span> <span class="toc-text">HEOI2016 字符串</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文献"><span class="toc-number">4.</span> <span class="toc-text">参考文献</span></a></li></ol></div><hr></div><div class="post-content"><p>关于本文中的符号的定义，参见《后缀自动机与后缀树》一文的摘要。</p><h2><a id="A-简单应用" href="#A-简单应用" class="headerlink" title="A 简单应用"></a>A 简单应用</h2><h3><a id="两个后缀-LCP" href="#两个后缀-LCP" class="headerlink" title="两个后缀 LCP"></a>两个后缀 LCP</h3><p><span class="label">后缀树</span></p><p>就是两个结点在 fail 树上的 LCA。</p><h3><a id="本质不同的子串个数" href="#本质不同的子串个数" class="headerlink" title="本质不同的子串个数"></a>本质不同的子串个数</h3><p><span class="label">后缀树</span></p><p>设<script type="math/tex">\ell(q)</script>表示等价类<script type="math/tex">q</script>中最长的字符串的长度，也就是通常称的<script type="math/tex">\text{len}(q)</script>。则显然<script type="math/tex">|q|=\ell(q)-\ell(\theta(q))</script>。因此<script type="math/tex">s</script>的本质不同子串个数为</p><script type="math/tex;mode=display">\sum_{q\in Q,q\ne q_0}\ell(q)-\ell(\theta(q))</script><h3><a id="字典序第-k-小子串" href="#字典序第-k-小子串" class="headerlink" title="字典序第 k 小子串"></a>字典序第 k 小子串</h3><p><span class="label">SAM</span></p><blockquote><p>多组询问，查询<script type="math/tex">s</script>的子串中字典序第<script type="math/tex">k</script>小的子串。</p></blockquote><p>遇到字典序最小的问题，就不太能用后缀树求解。因此我们直接利用<script type="math/tex">\delta</script>，在 SAM 上 DFS 一遍即可。</p><p>复杂度<script type="math/tex">O(|S||\Sigma|)</script>。</p><h3><a id="匹配同构串" href="#匹配同构串" class="headerlink" title="匹配同构串"></a>匹配同构串</h3><blockquote><p>询问在串<script type="math/tex">s</script>中出现了多少次<script type="math/tex">x</script>的循环同构串。</p></blockquote><p><span class="label">SAM</span></p><p>首先对<script type="math/tex">s</script>建 SAM，然后先在 SAM 上跑一遍<script type="math/tex">x</script>。再接着跑一遍，这次就可以记录答案了。我们记录一个当前匹配的长度，对<script type="math/tex">x</script>的长度取 min。这样我们就可以判断当前结点包含的状态中是否有<script type="math/tex">x</script>的循环同构串。有一个贪心的想法就是，每次走了一个字符，就贪心地跳 fail，要求 fail 的长度也大于等于当前匹配长度。因为 fail 的转移指针是包含它的儿子结点的。然后加上当前状态的出现次数即可。</p><p><a target="_blank" rel="noopener" href="https://codeforces.com/contest/235/problem/C">CF 234C</a></p><h2><a id="B-进阶套路" href="#B-进阶套路" class="headerlink" title="B 进阶套路"></a>B 进阶套路</h2><h3><a id="B1" href="#B1" class="headerlink" title="B1"></a>B1</h3><blockquote><p>设<script type="math/tex">f(i)</script>为所有长度为<script type="math/tex">i</script>的子串的出现次数的最大值，求<script type="math/tex">f(1),f(2),\cdots,f(|S|)</script>。<script type="math/tex">|S|\le 250000</script>。</p></blockquote><p>SAM 可以算出每个子串的出现次数。对于结点<script type="math/tex">u</script>，相当于区间<script type="math/tex">[\ell(\theta(u))+1,\ell(u)]</script>的答案对<script type="math/tex">cnt(u)</script>取<script type="math/tex">\max</script>。</p><p>事实上没有这么复杂。由于<script type="math/tex">f(i)\ge f(i+1)</script>，因此可以把区间左端点置为<script type="math/tex">1</script>，也就是个前缀<script type="math/tex">\max</script>。扫一遍即可。</p><p>时间复杂度<script type="math/tex">O(n)</script>。</p><h3><a id="B2" href="#B2" class="headerlink" title="B2"></a>B2</h3><blockquote><p>维护串<script type="math/tex">S</script>，支持</p><ol><li>在末端添加一个字符</li><li>询问<script type="math/tex">T</script>在<script type="math/tex">S</script>中的出现次数。</li></ol><p><script type="math/tex">\sum |T|,Q\le 10^5</script>。</p></blockquote><p>显然，我们需要动态维护 Fail 树，支持：</p><ol><li>添加一个叶子结点 / 中间多一个结点</li><li>查询子树和</li></ol><p>可以直接 LCT。但这题动态性较弱，可以平衡树维护 DFS 序来做。</p><p>离线的话直接把整个 SAM 建出来，然后询问离线搞一下就行。</p><h3><a id="B3" href="#B3" class="headerlink" title="B3"></a>B3</h3><blockquote><p>给定串<script type="math/tex">T</script>。对于串<script type="math/tex">s</script>，定义它的权值是至少需要几个<script type="math/tex">T</script>的子串拼起来得到。拼不出来就是<script type="math/tex">-1</script>。求长度为为<script type="math/tex">n</script>的权值最大的串的权值。</p><p><script type="math/tex">n\le 10^{18},1\le |T|\le 10^5,|\Sigma|\le 4</script>。</p></blockquote><p>对于一个串<script type="math/tex">s</script>，如何计算它的权值？</p><p>它满足贪心条件，我们贪心地匹配<script type="math/tex">T</script>的子串直到不能匹配，就断开。</p><p>假设分成<script type="math/tex">k</script>段<script type="math/tex">s_1\cdots s_k</script>，那么有<script type="math/tex">\forall s_i\in T, s_i(s_{i+1}[1])\notin T</script>。</p><p>于是我们设<script type="math/tex">w(x,y)</script>表示最短的串<script type="math/tex">s</script>使得<script type="math/tex">s[1]=x,s\in T,sy\notin T</script>的长度。显然可以瞎搞搞出来。</p><p>然后用它二分 + 矩乘即可得到答案。这是双 log 的。</p><p>把二分改成倍增就是单 log。</p><h3><a id="B4" href="#B4" class="headerlink" title="B4"></a>B4</h3><blockquote><p>给定字符串<script type="math/tex">S</script>，对于每个<script type="math/tex">k</script>，求把<script type="math/tex">S[k]</script>变成<code class="inline-code">#</code>后，本质不同的<script type="math/tex">S</script>的子串的个数。</p><p><script type="math/tex">1\le |S|\le 10^5</script>。</p></blockquote><p>容斥，我们要求的就是<script type="math/tex">S[1,k-1]</script>的本质不同数，<script type="math/tex">S[k+1,|S|]</script>的本质不同数，<script type="math/tex">S[1,k-1],S[k+1,|S|]</script>的公共本质不同子串数。前两者可以正着倒着建 SAM 求出。</p><p>对于后者，我们考虑每个 SAM 结点的贡献。</p><p>对于每个结点<script type="math/tex">u</script>，我们求出它出现的最左边和最右边的位置，分别记为<script type="math/tex">L,R</script>。</p><p>那么对于<script type="math/tex">x\in (\ell(\theta(u)),\ell(u)]</script>，区间<script type="math/tex">[L+x,R-1]</script>的答案就会加<script type="math/tex">1</script>。</p><p>差分一下，就变成了<script type="math/tex">x\in (\ell(\theta(u)),\ell(u)]</script>，<script type="math/tex">L+x</script>的加<script type="math/tex">1</script>，<script type="math/tex">R</script>的减<script type="math/tex">1</script>。</p><p>二次差分就变成纯单点了。</p><p>这样，总复杂度就是<script type="math/tex">O(|S||\Sigma|)</script>的。</p><h3><a id="B5-线段树维护-Right-集合" href="#B5-线段树维护-Right-集合" class="headerlink" title="B5 线段树维护 Right 集合"></a>B5 线段树维护 Right 集合</h3><p>所谓的 Right 集合是指一个状态<script type="math/tex">q</script>在原串中所有出现的位置的集合。</p><p>与求子串出现次数类似，我们在构建 SAM 的时候每次在 last 结点的集合里插入一个位置。然后建完 SAM 后线段树合并一下即可。</p><h2><a id="C" href="#C" class="headerlink" title="C"></a>C</h2><h3><a id="HEOI2016-字符串" href="#HEOI2016-字符串" class="headerlink" title="HEOI2016 字符串"></a>HEOI2016 字符串</h3><blockquote><p>给定字符串<script type="math/tex">s</script>和<script type="math/tex">q</script>个询问，每个问题形如<script type="math/tex">a, b, c, d</script>四个参数，询问<script type="math/tex">s[a,b]</script>的所有子串和<script type="math/tex">s[c,d]</script>的 LCP 的长度的最大值。<br><script type="math/tex">1 \le n, q \le 10^5</script>。</p></blockquote><p>首先把串翻转，问题转化为<script type="math/tex">s[a,b]</script>的子串与<script type="math/tex">s[c,d]</script>的 LCS 的长度的最大值。</p><p>也就是说我们想知道<script type="math/tex">s[c,d]</script>的最长的被包含在<script type="math/tex">s[a,b]</script>中的后缀。二分转化为判定问题。判定问题可以使用线段树维护 Right 集合来解决。</p><p>时间复杂度<script type="math/tex">O(n\log_2^2n)</script>。</p><h2><a id="参考文献" href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>OIWIKI. 后缀自动机 (SAM). <a target="_blank" rel="noopener" href="https://oi-wiki.org/string/sam/">https://oi-wiki.org/string/sam/</a></p></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2021年2月11日 第2次修订</li><li class="post-history-item">2020年7月23日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/21-WC-Sum/">2021 CCF 冬令营 游记</a></div><div class="prev-post"><a href="/Probset/eJOI/">eJOI 题目选做 </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>