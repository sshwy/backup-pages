<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>「DP 趣题」进省队 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">「DP 趣题」进省队</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2019年10月22日星期二晚上6点40分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2019年10月22日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 1,982 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> <a class="directory" href="/directory/DP/">DP </a><span class="icon smallarrow"></span> 当前文章</div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#题目描述"><span class="toc-number">1.</span> <span class="toc-text">题目描述</span></a></li></ol></div><hr></div><div class="post-content"><p>杜老师给我讲的一道 DP 题～</p><h2><a id="题目描述" href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>某省省选，共<script type="math/tex">n</script>个参赛选手，来自<script type="math/tex">m</script>所学校，省队名额为<script type="math/tex">a</script>人，每个学校最多进入<script type="math/tex">\left\lfloor\frac{a}{k}\right\rfloor</script>个省队。决定省队名单的方案如下：将所有选手按成绩从高到低排序，如果加上这一位选手后，名单中的人数不超过<script type="math/tex">a</script>人，并且每个学校在名单中的人数不超过<script type="math/tex">\left\lfloor\frac{a}{k}\right\rfloor</script>，就让这位选手进队，否则就不让。</p><p>给定<script type="math/tex">n,m,k</script>，以及按照成绩从高到低排序后（可以认为不会出现相同分数），每个人是否进入了省队，你需要求出在省队总名额与进入省队人数相等的前提下，每个人所在学校的可能状态数。两个状态不同当且仅当存在一个人两个状态中所在的学校不同。答案可能很大，输出答案<script type="math/tex">\bmod 998244353</script>即可。</p><p>当然，你无法保证名单的正确性，所以答案可能为<script type="math/tex">0</script>。</p><p>输入格式：</p><p>第一行包含三个正整数<script type="math/tex">n,m,k</script>，表示参加省选的人数，学校的个数，名额限制的比例。</p><p>第二行包含了一个长度为<script type="math/tex">n</script>的<script type="math/tex">01</script>串，第<script type="math/tex">i</script>位为<script type="math/tex">0</script>表示第<script type="math/tex">i</script>个人没有进省队，否则进了省队。</p><p>输出格式：</p><p>一行，表示可能的状态数<script type="math/tex">\bmod 998244353</script>。</p><hr><p>这题的做法很抽象，将两个抽象方案的统计合在一起才能完成对原问题方案的统计。</p><p>设<script type="math/tex">L=\left\lfloor\frac{a}{k}\right\rfloor</script>，同时设<script type="math/tex">c_i</script>表示前<script type="math/tex">i</script>个人中进省队的人数：</p><script type="math/tex;mode=display">c_i=\sum_{j=1}^{i}[s_j=1]</script><p>思路的出发点是这样的。如果<script type="math/tex">s_x=0</script>，意味着第<script type="math/tex">x</script>个人被学校杀了，也就是说前<script type="math/tex">x-1</script>个人中恰有<script type="math/tex">L</script>个人和这个人属于一所强校。于是我们设<script type="math/tex">f(i,j)</script>表示考虑前<script type="math/tex">i</script>个人，<strong>恰好</strong>有<script type="math/tex">j</script>所强校，这些强校皆有<script type="math/tex">L</script>个人进省队，剩下<script type="math/tex">i-jL</script>个是不属于强校的杂鱼，这样的不同强校与杂鱼选手的位置的方案数。</p><p>形式化地，设长度为<script type="math/tex">i</script>的序列<script type="math/tex">A</script>表示第<script type="math/tex">j</script>个人属于第<script type="math/tex">A_j</script>个学校（<script type="math/tex">1\le A_j\le m</script>）的方案，同时我们设一个布尔函数<script type="math/tex">C(A,x)</script>表示在方案<script type="math/tex">A</script>中，<script type="math/tex">x</script>是否是强校：</p><script type="math/tex;mode=display">C(A,x)=\left[\left(\sum_{j=1}^i[s_j=1\wedge A_j=x]\right)=L\right]</script><p>（注意，一个学校不可能有多于<script type="math/tex">L</script>个人进队）则我们认为两个方案<script type="math/tex">A,B</script>等价当且仅当：</p><ol><li>对于任意<script type="math/tex">j\in[1,i]</script>，存在<script type="math/tex">C(A,A_j)=C(B,B_j)</script>。即两个方案同一个位置上的人要么都属于强校，要么都是杂鱼；</li><li>对于任意<script type="math/tex">p\ne q\in[1,i],C(A,A_p)=C(A,A_q)=1</script>，存在<script type="math/tex">[A_p=A_q]=[B_p=B_q]</script>。即方案中的两个人如果都属于强校，那么这两个人要么在两种方案中都属于同一个学校，要么都不属于同一个学校。</li></ol><p>换句话说两个方案相同当且仅当任意选手的关系是相同的。这里的关系指是否是强校 / 杂鱼，强校还要区分是否是同一所强校。</p><p>于是<script type="math/tex">f(i,j)</script>表示使用上述规则的不同的方案数。转移时枚举第<script type="math/tex">i</script>个人是否进省队：</p><ol><li>进省队，则枚举是强校选手 / 杂鱼；如果是强校选手就枚举它属于哪一个强校（枚举<script type="math/tex">L-1</script>个人和他组一个强校）；如果是杂鱼就直接用<script type="math/tex">i-1</script>的方案转移。</li><li>学校杀，则他一定是强校选手，枚举是哪一个强校。</li></ol><p>综上得到：</p><script type="math/tex;mode=display">f(i,j)=\begin{cases}
f(i-1,j-1)\dbinom{c_i-1-(j-1)L}{L-1}+f(i-1,j) & s_i=1\\
f(i-1,j)j & s_i=0
\end{cases}</script><p>边界<script type="math/tex">f(0,0)=1</script>。</p><hr><p>接下来我们考虑<strong>杂鱼</strong>的学校选择的方案统计。</p><p>设<script type="math/tex">g(j,i)</script>表示<strong>恰好</strong>有<script type="math/tex">j</script>所强校满<script type="math/tex">L</script>人进队，剩下<script type="math/tex">i</script>个杂鱼进队的学校选择（但不考虑强校是哪所学校）的方案数。相当于总共有<script type="math/tex">t=jL+i</script>个人进队。注意这里指的是所有人进队！相当于把进队的人方案计算出来，最后乘上一个<script type="math/tex">f</script>。</p><p>我们同样用形式化的语言描述。设长度为<script type="math/tex">t</script>的序列<script type="math/tex">A</script>为第<script type="math/tex">j</script>个人属于第<script type="math/tex">A_j</script>个学校（<script type="math/tex">1\le A_j\le m</script>）的方案。关于<script type="math/tex">C(A,x)</script>的定义与上文相似，表示前<script type="math/tex">t</script>个人中<script type="math/tex">x</script>是否是强校。则两个方案<script type="math/tex">A,B</script>等价当且仅当</p><ol><li>对于任意<script type="math/tex">j\in[1,t]</script>，存在<script type="math/tex">C(A,A_j)=C(B,B_j)</script>。</li><li>对于任意<script type="math/tex">j\in[1,t],C(A,A_j)=0</script>，存在<script type="math/tex">A_j=B_j</script>。即杂鱼选的学校要一样。</li></ol><p>通俗地说，<script type="math/tex">g</script>就是把杂鱼的学校的具体选择考虑进去了。但这里不要求区分不同强校选手之间的位置关系（因为这个关系已经在<script type="math/tex">f</script>中被讨论过了），但会考虑强校与杂鱼选手之间的位置关系。</p><p>转移的时候枚举最后一个人是哪个杂鱼学校，他只能在<script type="math/tex">m-j</script>所学校中选择。但这样有一个 Bug，就是可能他选了一个之后使得另一个学校刚好满<script type="math/tex">L</script>个人进队，成为强校（即<script type="math/tex">g(j+1,i-L)</script>的状态），因此要减掉这种不合法的状态：</p><script type="math/tex;mode=display">g(j,i)=g(j,i-1)(m-j)-g(j+1,i-L)\binom{i-1}{L-1}(m-j)</script><p>边界<script type="math/tex">g(j,0)=1</script>。转移的时候<script type="math/tex">j</script>倒着转移即可。</p><hr><p>最后统计答案，设<script type="math/tex">k'=\left\lfloor\frac{a}{\lfloor\frac{a}{k}\rfloor}\right\rfloor</script>：</p><script type="math/tex;mode=display">\sum_{j=0}^{\min(k',\frac{a}{L})}f(n,j)g(j,a-jL)m^{\underline{j}}</script><p>其中<script type="math/tex">m^{\underline{j}}=m(m-1)\cdots(m-j+1)</script>，即<script type="math/tex">m</script>的<script type="math/tex">j</script>次下降幂。这个式子可以理解为，枚举强校个数，<script type="math/tex">f(n,j)</script>枚举不同强校与杂鱼之间的位置关系，<script type="math/tex">g(j,a-jL)</script>枚举杂鱼的学校选择方案，<script type="math/tex">m^{\underline{j}}</script>枚举强校的学校选择方案，这样统计方案数。</p><p>总复杂度<script type="math/tex">O(nk)</script>。</p></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2019年10月22日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/DP/ZROI1015-ISN/">普转提 Day5 ISN</a></div><div class="prev-post"><a href="/Data-Structure/Line-Tree/">Line Tree </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>