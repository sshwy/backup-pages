<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>转置原理与多点求值 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">转置原理与多点求值</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2020年5月28日星期四晚上9点43分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2020年5月28日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 2,347 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> <a class="directory" href="/directory/Math/">数学 </a><span class="icon smallarrow"></span> <a class="directory" href="/directory/Math/Polynomial/">多项式与生成函数 </a><span class="icon smallarrow"></span> 当前文章</div><div class="post-tags"><span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Notes/">Notes</a></span> <span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Math/">Math</a></span></div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#转置原理"><span class="toc-number">1.</span> <span class="toc-text">转置原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多项式多点求值"><span class="toc-number">2.</span> <span class="toc-text">多项式多点求值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#初等变换"><span class="toc-number">3.</span> <span class="toc-text">初等变换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多项式乘法"><span class="toc-number">4.</span> <span class="toc-text">多项式乘法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#转置后的算法"><span class="toc-number">5.</span> <span class="toc-text">转置后的算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#还原转置"><span class="toc-number">6.</span> <span class="toc-text">还原转置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文献"><span class="toc-number">7.</span> <span class="toc-text">参考文献</span></a></li></ol></div><hr></div><div class="post-content"><h2><a id="转置原理" href="#转置原理" class="headerlink" title="转置原理"></a>转置原理</h2><p>转置原理，或称特勒根原理（Tellegen’s Principle），指的是对于矩阵<script type="math/tex">\textbf{M}</script>和向量<script type="math/tex">\textbf{v}</script>，为优化计算<script type="math/tex">\textbf{Mv}</script>，我们可以考察<script type="math/tex">\textbf{M}^T\textbf{v}</script>的计算方法。原因是设有分解<script type="math/tex">\textbf{M}=\textbf{E}_1\cdots\textbf{E}_k</script>，那么<script type="math/tex">\textbf{M}^T=\textbf{E}_k^T\cdots\textbf{E}_1^T</script>。</p><p>也就是说，如果<script type="math/tex">\textbf{M}^T\textbf{v}</script>有快速的计算方法，那么<script type="math/tex">\textbf{M}\textbf{v}</script>在原理上也一定拥有相同复杂度的算法。</p><h2><a id="多项式多点求值" href="#多项式多点求值" class="headerlink" title="多项式多点求值"></a>多项式多点求值</h2><p>多点求值（multi point evaluation），指的是给出多项式<script type="math/tex">F(x)=\sum_{i=0}^{n-1}f_ix^i</script>以及<script type="math/tex">n</script>个横坐标<script type="math/tex">a_0,a_1,\cdots,a_{n-1}</script>，快速求出<script type="math/tex">F(a_0),F(a_1),\cdots,F(a_{n-1})</script>。目前已有的算法是通过多项式取模来实现。</p><p>注意到，多点求值本质上是对向量<script type="math/tex">\textbf{v}=[f_0,\cdots,f_{n-1}]^T</script>做一个线性变换：</p><script type="math/tex;mode=display">\begin{bmatrix}
1 & a_0 & a_0^2 & \cdots & a_0^{n-1}\\
1 & a_1 & a_1^2 & \cdots & a_1^{n-1}\\
\vdots & \vdots & \vdots & \ddots & \vdots \\
1 & a_{n-1} & a_{n-1}^2 & \cdots & a_{n-1}^{n-1}\\
\end{bmatrix}
\begin{bmatrix}
f_0 \\ f_1 \\ \vdots \\ f_{n-1}
\end{bmatrix}=
\begin{bmatrix}
F(a_0) \\ F(a_1) \\ \vdots \\ F(a_{n-1})
\end{bmatrix}</script><p>这个矩阵是一个范德蒙德矩阵，记作<script type="math/tex">\textbf{V}</script>。我们把矩阵转置一下得到</p><script type="math/tex;mode=display">\textbf{V}^T\textbf{v}=\begin{bmatrix}
1 & 1 & 1 & \cdots & 1\\
a_0 & a_1 & a_2 & \cdots & a_{n-1}\\
\vdots & \vdots & \vdots & \ddots & \vdots \\
a_0^{n-1} & a_1^{n-1} & a_2^{n-1} & \cdots & a_{n-1}^{n-1}\\
\end{bmatrix}
\begin{bmatrix}
f_0 \\ f_1 \\ \vdots \\ f_{n-1}
\end{bmatrix}</script><p>观察发现，转置后的变换，向量的第<script type="math/tex">j</script>项求的是<script type="math/tex">\sum_{i=0}^{n-1}f_ia_i^j</script>。写出它的生成函数，因此我们求的是</p><script type="math/tex;mode=display">\sum_{j\ge 0}x^j\sum_{i=0}^{n-1}f_ia_i^j=\sum_{i=0}^{n-1}\frac{f_i}{1-a_ix}</script><p>这个多项式的前<script type="math/tex">n</script>项的系数（对<script type="math/tex">x^n</script>取模）。这个东西可以分治多项式乘法计算。</p><p>那么我们把这个矩阵转置回去，就可以得到多点求值的算法。也就是说本质上我们可以把所有初等变换写下来，然后转置一下并反转这个操作序列，然后再照着做一遍，就得到了相同复杂度的多点求值做法。但是这个过于憨批，想必没人会去实现它。为此我们需要分析计算<script type="math/tex">\textbf{V}^T\textbf{v}</script>的过程中变换的转置变换是什么。</p><h2><a id="初等变换" href="#初等变换" class="headerlink" title="初等变换"></a>初等变换</h2><p>本质上我们进行的变换有如下两种：</p><ul><li>把变量<script type="math/tex">x</script>乘一个常数<script type="math/tex">c</script>，记作<script type="math/tex">x\gets xc</script>。</li><li>把变量<script type="math/tex">x</script>乘<script type="math/tex">c</script>加到变量<script type="math/tex">y</script>上，记作<script type="math/tex">y\gets y+xc</script>。</li></ul><p>注意，变量的交换可以使用上面两个操作完成。</p><p>它们的转置操作分别是</p><ul><li>把变量<script type="math/tex">x</script>乘一个常数<script type="math/tex">c</script>，记作<script type="math/tex">x\gets xc</script>（不变）。</li><li>把变量<script type="math/tex">y</script>乘<script type="math/tex">c</script>加到变量<script type="math/tex">x</script>上，记作<script type="math/tex">x\gets x+yc</script>。</li></ul><p>这个大家可以写出初等变换矩阵，然后转置一下，自行验证。</p><h2><a id="多项式乘法" href="#多项式乘法" class="headerlink" title="多项式乘法"></a>多项式乘法</h2><p>多项式乘法的变换过程是，给出多项式<script type="math/tex">F(x)=f_0+\cdots+f_{n-1}x^{n-1}</script>和<script type="math/tex">G(x)=g_0+\cdots+g_{m-1}x^{m-1}</script>，那么对于<script type="math/tex">H(x)=F(x)G(x)</script>，有<script type="math/tex">h_{i+j}\gets h_{i+j}+f_ig_j</script>，其中<script type="math/tex">0\le i&lt;n,0\le j&lt;m</script>。</p><p>我们设<script type="math/tex">g</script>是一个常数多项式，而<script type="math/tex">f</script>是输入。那么这个变换的转置就是：<script type="math/tex">h_i\gets h_i+f_{i+j}g_j</script>，其中<script type="math/tex">0\le i+j&lt;n,0\le j&lt;m</script>。容易发现，这样求出的<script type="math/tex">h</script>有<script type="math/tex">n</script>项。我们记这个变换是<script type="math/tex">h=f\otimes g</script>。</p><p>这个可以倒过来 NTT 计算。</p><h2><a id="转置后的算法" href="#转置后的算法" class="headerlink" title="转置后的算法"></a>转置后的算法</h2><p>接下来我们具体考虑求<script type="math/tex">\sum_{i=0}^{n-1}\frac{f_i}{1-a_ix}</script>的算法。</p><p>设<script type="math/tex">g(x)=\prod_{i=0}^{n-1}(1-a_ix)</script>，那么我们可以先求出<script type="math/tex">\sum_{i=0}^{n-1}\frac{f_ig(x)}{1-a_ix}</script>，然后再乘上<script type="math/tex">g^{-1}</script>即可。</p><p>求<script type="math/tex">T(x)=\sum_{i=0}^{n-1}\frac{f_ig(x)}{1-a_ix}</script>的过程可以分治计算：</p><ul><li><p>如果<script type="math/tex">n=1</script>，那么直接返回<script type="math/tex">f_i</script>。</p></li><li><p>否则，设<script type="math/tex">m=\lfloor \frac{n}{2} \rfloor</script>。</p><ul><li>令<script type="math/tex">T_L=\sum_{i=0}^{m-1}\frac{f_ig(x)}{1-a_ix}</script>，<script type="math/tex">T_R=\sum_{i=m}^{n-1}\frac{f_ig(x)}{1-a_ix}</script>。</li><li>令<script type="math/tex">g_L=\prod_{i=0}^{m-1}(1-a_ix)</script>，<script type="math/tex">g_R=\prod_{i=m}^{n-1}(1-a_ix)</script>。</li><li>那么有<script type="math/tex">T=T_Lg_R+T_Rg_L</script>，<script type="math/tex">g=g_Lg_R</script>。因此两边分别递归求<script type="math/tex">(T,g)</script>即可。</li></ul></li></ul><p>最后对于求出的<script type="math/tex">T</script>，乘上<script type="math/tex">g^{-1}</script>并对<script type="math/tex">x^n</script>取模。</p><p>由于多项式乘法的复杂度是<script type="math/tex">O(n\log_2n)</script>的，因此该算法的总复杂度为<script type="math/tex">O(n\log_2^2n)</script>。</p><h2><a id="还原转置" href="#还原转置" class="headerlink" title="还原转置"></a>还原转置</h2><p>那么我们考虑多点求值的算法。</p><p>首先，我们操作是倒过来并且经过转置的。</p><p>其次，<script type="math/tex">g(x)</script>在算法过程中是常量（只和<script type="math/tex">a_i</script>有关，和<script type="math/tex">f_i</script>无关）。</p><p>把<script type="math/tex">f_i</script>当作输入，也就是说<script type="math/tex">T(x)=\sum_{i=0}^{n-1}f_ix^i</script>。</p><p>首先让<script type="math/tex">T=T\otimes g^{-1}</script>。注意，对<script type="math/tex">g</script>求逆的过程是对常量求逆的过程，因此不需要转置，直接多项式求逆。</p><p>然后我们把上述分治算法倒过来并转置：</p><ul><li>如果<script type="math/tex">n=1</script>，则<script type="math/tex">T</script>是一个常数，直接返回<script type="math/tex">T</script>即可（存储到数组上）。</li><li>否则，设<script type="math/tex">m=\lfloor\frac{n}{2}\rfloor</script>。<ul><li>原本是<script type="math/tex">T=T_Lg_R+T_Rg_L</script>，转置后就变成了：<script type="math/tex">T_L=T\otimes g_R</script>，<script type="math/tex">T_R=T\otimes g_L</script>。</li><li>并且<script type="math/tex">T_L</script>只需要保留前<script type="math/tex">m</script>项，<script type="math/tex">T_R</script>只需要保留前<script type="math/tex">n-m</script>项。</li><li><script type="math/tex">g=g_Lg_R</script>是不变的，因为是常量。实际上这个应该是预处理的。</li></ul></li></ul><p>算法在叶子处的值就是对应的点值。</p><p>该算法的时间复杂度仍是<script type="math/tex">O(n\log_2^2n)</script>，但不用每次都多项式求逆，常数大大减小。</p><h2><a id="参考文献" href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="http://_rqy.blog.uoj.ac/blog/6202">QY 为什么可以 5e5 多点求值 (详细揭秘) - rqy</a></p><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/blog/EntropyIncreaser/solution-p5050">题解 P5050 【模板】多项式多点求值 - EI</a></p></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2020年5月28日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/Math/Polynomial/Polynomial-Pro/">多项式进阶</a></div><div class="prev-post"><a href="/Math/Polynomial/Binary-Lifting-Eval/">点值平移与倍增求值学习笔记 </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>