<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>点值平移与倍增求值学习笔记 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">点值平移与倍增求值学习笔记</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2020年6月7日星期日下午2点18分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2020年6月7日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 1,722 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> <a class="directory" href="/directory/Math/">数学 </a><span class="icon smallarrow"></span> <a class="directory" href="/directory/Math/Polynomial/">多项式与生成函数 </a><span class="icon smallarrow"></span> 当前文章</div><div class="post-tags"><span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Notes/">Notes</a></span></div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#点值平移"><span class="toc-number">1.</span> <span class="toc-text">点值平移</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#阶乘计算"><span class="toc-number">2.</span> <span class="toc-text">阶乘计算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自然倒数幂和"><span class="toc-number">3.</span> <span class="toc-text">自然倒数幂和</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文献"><span class="toc-number">4.</span> <span class="toc-text">参考文献</span></a></li></ol></div><hr></div><div class="post-content"><p>为方便书写，我们把点值序列<script type="math/tex">f(x_1),f(x_2),\cdots,f(x_m)</script>用符号<script type="math/tex">f(x_1,x_2,\cdots,x_m)</script>表示。</p><h2><a id="点值平移" href="#点值平移" class="headerlink" title="点值平移"></a>点值平移</h2><blockquote><p>给出（小于等于）<script type="math/tex">k</script>次多项式<script type="math/tex">h(x)</script>的<script type="math/tex">k+1</script>个点值<script type="math/tex">h(0,1,\cdots,k)</script>，求<script type="math/tex">h(d,1+d,\cdots,k+d)</script>。</p></blockquote><p>考虑拉格朗日插值：</p><script type="math/tex;mode=display">\begin{aligned}
h(x+d) &=\sum_{i=0}^kh(i)\prod_{j\ne i}\frac{x+d-j}{i-j} \\
&=(x+d)^{\underline{k+1}}\sum_{i=0}^k\frac{1}{x+d-i}
\frac{h(i)(-1)^{k-i}}{i!(k-i)!} \\
\end{aligned}</script><p>前面的下降幂可以<script type="math/tex">O(k)</script>预处理。后面是一个卷积的形式，可以<script type="math/tex">O(k\log_2k)</script>求出。总时间复杂度<script type="math/tex">O(k\log_2k)</script>。</p><p>但是存在一个问题。如果<script type="math/tex">x+d-i=0</script>，就会出现分母为<script type="math/tex">0</script>的情况。这个可以细节处理。对于每个<script type="math/tex">x</script>，<script type="math/tex">x+d-i=0</script>只会出现一次。因此我们定义一个函数<script type="math/tex">t(i)=\frac{1}{i}\;(i&gt;0)</script>，特别地，<script type="math/tex">t(0)=0</script>。这样就相当于把<script type="math/tex">x+d-i</script>的贡献减掉了。然后我们枚举一遍<script type="math/tex">x</script>，对于存在<script type="math/tex">x+d-i=0</script>的情况，把贡献加上去即可（加贡献的时候要变换一下上面的式子，把为 0 的分母去掉就行）。</p><p>总时间复杂度仍为<script type="math/tex">O(k\log_2k)</script>。</p><p>接下来我们来看一下点值平移算法的应用。</p><h2><a id="阶乘计算" href="#阶乘计算" class="headerlink" title="阶乘计算"></a>阶乘计算</h2><blockquote><p>计算<script type="math/tex">n!\bmod p</script>。</p><p><script type="math/tex">n&lt;p</script>。</p></blockquote><p>设<script type="math/tex">f_T(x)=\prod_{i=1}^{T}(x+i)</script>。那么我们求出<script type="math/tex">f_T(x)</script>的<script type="math/tex">\frac{n}{T}</script>个点值即可求出答案。</p><p>不妨令<script type="math/tex">T=\lfloor\sqrt{n}\rfloor</script>。我们求出<script type="math/tex">f_T(0,T,2T,\cdots,T^2)</script>即可。</p><p>考虑倍增。假设我们求出了<script type="math/tex">f_k(0,T,2T,\cdots,kT)</script>，如何求出<script type="math/tex">f_{2k}(0,T,2T,\cdots,2kT)</script>？</p><p>由于<script type="math/tex">f_{2k}(x)=f_k(x)f_k(x+k)</script>。问题转化为求出</p><ul><li><script type="math/tex">f_k(kT+T,kT+2T,\cdots,2kT)</script>。</li><li><script type="math/tex">f_k(k,T+k,2T+k,\cdots,2kT+k)</script>。</li></ul><p>这两个问题可以转化为点值平移问题。</p><p>那么设<script type="math/tex">h(x)=f_k(Tx)</script>，那么有：<script type="math/tex">f_k(0,T,\cdots,kT)=h(0,1,\cdots,k)</script>，<script type="math/tex">f_k(kT+T,kT+2T,\cdots,2kT,2kT+T)=h(k+1,\cdots,2k+1)</script>，令<script type="math/tex">d=k+1</script>，这样第一个问题就解决了。</p><p>对于第二个问题，我们拆成前后两半。以前半部分为例（两者只差一个常数）。我们要求<script type="math/tex">f_k(k,T+k,\cdots,kT+k)</script>。等价于<script type="math/tex">h(\frac{k}{T},1+\frac{k}{T},\cdots,k+\frac{k}{T})</script>。因此令<script type="math/tex">d=\frac{k}{T}</script>即可。后半部分同理。</p><p>综上所述，我们可以在<script type="math/tex">O(k\log_2k)</script>的时间内用<script type="math/tex">f_k(0,T,\cdots,kT)</script>求出<script type="math/tex">f_{2k}(0,T,\cdots,2kT)</script>。</p><p>另外，用<script type="math/tex">f_k(0,T,2T,\cdots,kT)</script>求出<script type="math/tex">f_{k+1}(0,T,2T,\cdots,kT,(k+1)T)</script>可以直接暴力。复杂度<script type="math/tex">O(k)</script>。</p><p>该算法的总复杂度是<script type="math/tex">O(T\log_2T)</script>。</p><h2><a id="自然倒数幂和" href="#自然倒数幂和" class="headerlink" title="自然倒数幂和"></a><a target="_blank" rel="noopener" href="http://www.zhengruioi.com/contest/629/problem/1433">自然倒数幂和</a></h2><blockquote><p>计算<script type="math/tex">\sum_{i=1}^ni^{-k} \bmod p</script>。</p><p><script type="math/tex">k&gt;0</script>。</p></blockquote><p>首先这并不是一个容易处理的多项式函数。因此我们需要做一些转化：</p><script type="math/tex;mode=display">\sum_{i}\frac{1}{i^k} = \sum_{i}\frac{\prod_{j\ne i}j^k}{\prod_j j^k} =\frac{\sum_i\prod_{j\ne i}j^k}{\prod_j j^k}</script><p>分子分母都是多项式。因此我们分别求出两者在<script type="math/tex">x=n</script>处的点值即可。</p><p>设<script type="math/tex">f_T(x)=\prod_{i=1}^{T}(x+i)^k</script>，设<script type="math/tex">g_T(x)=\sum_{i=1}^T\frac{f_T(x)}{(x+i)^k}</script>。那么有<script type="math/tex">\frac{g_T(x)}{f_T(x)}=\sum_{i=1}^T(x+i)^{-k}</script>。</p><p>因此我们只需要对<script type="math/tex">f_T,g_T</script>分别做多点求值即可。</p><p>注意到<script type="math/tex">f_T,g_T</script>是<script type="math/tex">Tk</script>次的多项式，而我们要求的点值数是<script type="math/tex">\frac{n}{T}</script>的。不妨令<script type="math/tex">Tk=\frac{n}{T}</script>，得到<script type="math/tex">T=\sqrt{\frac{n}{k}}</script>。</p><p>问题转化为求出<script type="math/tex">f_T(0,T,\cdots,T^2)</script>和<script type="math/tex">g_T(0,T,\cdots,T^2)</script>。</p><p>考虑倍增。问题转化为</p><ul><li>用<script type="math/tex">f_k(0,T,\cdots,kT)</script>求出<script type="math/tex">f_{2k}(0,T,\cdots,2kT)</script>。</li><li>用<script type="math/tex">g_k(0,T,\cdots,kT)</script>求出<script type="math/tex">g_{2k}(0,T,\cdots,2kT)</script>。</li></ul><p>由于<script type="math/tex">f_{2k}(x)=f_k(x)f_k(x+k)</script>，所以可以类似上一题一样做。</p><p>由于<script type="math/tex">g_{2k}(x)=g_k(x)f_k(x+k)+f_k(x)g_k(x+k)</script>，所以结合一下<script type="math/tex">f_k</script>的计算结果就可以了。</p><p>时间复杂度<script type="math/tex">O(T\log_2T)</script>。</p><h2><a id="参考文献" href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zzqsblog/p/8408691.html">「翻译向」阶乘模大质数 - ZZQ’s Blog</a></p><p><a target="_blank" rel="noopener" href="https://min-25.hatenablog.com/entry/2017/04/10/215046">階乗 mod 素数 - min-25</a></p></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2020年6月7日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/Math/Polynomial/Multi-Point-Eval/">转置原理与多点求值</a></div><div class="prev-post"><a href="/WQS-Binary-Search/">WQS 二分学习笔记 </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>