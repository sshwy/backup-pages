<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>自然数幂和小结 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">自然数幂和小结</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2021年3月27日星期六晚上6点26分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2021年3月27日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 2,264 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> <a class="directory" href="/directory/Math/">数学 </a><span class="icon smallarrow"></span> 当前文章</div><div class="post-tags"><span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Notes/">Notes</a></span> <span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Math/">Math</a></span> <span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Stirling-Number/">Stirling-Number</a></span></div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#等幂求和问题"><span class="toc-number">1.</span> <span class="toc-text">等幂求和问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#插值法"><span class="toc-number">2.</span> <span class="toc-text">插值法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#拉格朗日插值法"><span class="toc-number">2.1.</span> <span class="toc-text">拉格朗日插值法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#差分法"><span class="toc-number">2.2.</span> <span class="toc-text">差分法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二项式定理"><span class="toc-number">3.</span> <span class="toc-text">二项式定理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#斯特林数"><span class="toc-number">4.</span> <span class="toc-text">斯特林数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#伯努利数"><span class="toc-number">5.</span> <span class="toc-text">伯努利数</span></a></li></ol></div><hr></div><div class="post-content"><p>开个小坑，介绍自然数幂和（等幂求和）问题以及相关算法。</p><h2><a id="等幂求和问题" href="#等幂求和问题" class="headerlink" title="等幂求和问题"></a>等幂求和问题</h2><p>等幂求和问题（Faulhaber’s formula）<sup><a id="reffn_1" class="headerlink" title="1"></a><a href="#fn_1">1</a></sup> 指计算多项式</p><script type="math/tex;mode=display">f_k(n) = \sum_{i=0}^n i^k = 0^k+1^k+2^k+\cdots +n^k</script><p>的值。</p><p>对于<script type="math/tex">k</script>较小的情况：</p><ul><li>当<script type="math/tex">k=1</script>时有<script type="math/tex">f_1(n) = \frac{n(n+1)}{2}</script>。</li><li>当<script type="math/tex">k=2</script>时有<script type="math/tex">f_2(n) = \frac{n(n+1)(2n+1)}{6}</script>。</li></ul><h2><a id="插值法" href="#插值法" class="headerlink" title="插值法"></a>插值法</h2><p>使用插值法计算的主要方式是，先利用多项式的<script type="math/tex">O(k)</script>个点值得出该多项式的表示，然后用此表示来计算点值。</p><h3><a id="拉格朗日插值法" href="#拉格朗日插值法" class="headerlink" title="拉格朗日插值法"></a>拉格朗日插值法</h3><p>如果只是单点求值，那么可以直接利用拉格朗日多项式</p><script type="math/tex;mode=display">\sum_{i}y_i\prod_{j\ne i}\frac{x-x_j}{x_i-x_j}</script><p>来计算。单次求值的时间复杂度是<script type="math/tex">O(k^2)</script>。</p><p>如果取<script type="math/tex">x_i=i</script>，那么在模意义下可以使用阶乘及其逆元来进一步优化，做到<script type="math/tex">O(k)</script>的时间计算点值。</p><p>如果要得到<script type="math/tex">F_k</script>的系数表示，那么暴力模拟多项式展开的过程是<script type="math/tex">O(k^3)</script>的。</p><p>使用缺一背包的方式分治计算可以做到<script type="math/tex">O(k^2\log_2k)</script>。</p><h3><a id="差分法" href="#差分法" class="headerlink" title="差分法"></a>差分法</h3><p>取<script type="math/tex">x_i = i</script>（<script type="math/tex">0\le i\le k+1</script>）共<script type="math/tex">k+2</script>个点，然后将其差分。</p><p>具体地，设<script type="math/tex">d_j(i) = d_{j-1}(i)-d_{j-1}(i-1)</script>，<script type="math/tex">j</script>表示差分的次数，<script type="math/tex">d_0(i) = i</script>。那么有</p><script type="math/tex;mode=display">F_k(n) = \sum_{i=0}^{k+1} \binom{n}{i} d_i(i)</script><p>这实际上是求出了<script type="math/tex">F_k(n)</script>的下降幂表示。利用斯特林数的变换：</p><script type="math/tex;mode=display">n^{\underline{k}} = \sum_{i = 0}^ks(k, i)(-1)^{k-i}n^i</script><p>我们也可以在<script type="math/tex">O(k^2)</script>的时间内将其转化为常幂系数表示。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/mb/faulhaber.cpp">代码</a></p><h2><a id="二项式定理" href="#二项式定理" class="headerlink" title="二项式定理"></a>二项式定理</h2><p>利用二项式定理也可以计算等幂求和，其主要思想是通过差分、裂项等方法构造等式，推导递推式。首先</p><script type="math/tex;mode=display">(x+1)^k = \sum_{i =0}^k\binom{k}{i}x^i</script><p>通过移项构造一个差分形式：</p><script type="math/tex;mode=display">(x+1)^k-x^k = \sum_{i=0}^{k-1}\binom{k}{i}x^i</script><p>这样就能得到</p><script type="math/tex;mode=display">\begin{aligned}
n^k &= \sum_{i=0}^{n-1}(i+1)^k-i^k\\
&= \sum_{i=0}^{n-1}\sum_{j=0}^{k-1}\binom{k}{j}i^j\\
&= \sum_{j=0}^{k-1}\binom{k}{j}F_j(n-1)
\end{aligned}</script><p>然后我们再次移项得到<script type="math/tex">F_{k-1}</script>的递推式：</p><script type="math/tex;mode=display">F_{k-1}(n-1) = \frac{n^k-\sum_{j=0}^{k-2}\binom{k}{j}F_j(n-1)}{k}</script><p>所以整理一下得到</p><script type="math/tex;mode=display">F_{k}(n) = \frac{n^{k+1}-\sum_{j=0}^{k-1}\binom{k+1}{j}F_j(n)}{k+1}</script><h2><a id="斯特林数" href="#斯特林数" class="headerlink" title="斯特林数"></a>斯特林数</h2><p>使用斯特林数计算等幂求和的要点在于构造递归式。由下降幂转通常幂的公式：</p><script type="math/tex;mode=display">n^{\underline{m}}=\sum_{i=0}^m(-1)^{m-i}s(m,i)n^i</script><p>移项得到</p><script type="math/tex;mode=display">n^m=n^{\underline{m}}-\sum_{i=0}^{m-1}(-1)^{m-i}s(m,i)n^i</script><p>所以我们把这个公式代入等幂求和公式得到</p><script type="math/tex;mode=display">\begin{aligned}
F_k(n)&=\sum_{i=1}^n\left(i^{\underline{k}} -\sum_{j=0}^{k-1}(-1)^{k-j}s(k,j)i^j \right)\\
&=k!\sum_{i=1}^n\binom{i}{k}-\sum_{j=0}^{k-1}(-1)^{k-j}s(k,j)F_j(n)\\
&=k!\binom{n+1}{k+1}-\sum_{j=0}^{k-1}(-1)^{k-j}s(k,j)F_j(n)
\end{aligned}</script><p>这样我们就可以递归求解了。</p><h2><a id="伯努利数" href="#伯努利数" class="headerlink" title="伯努利数"></a>伯努利数</h2><p>等幂求和也可以借助伯努利数<sup><a id="reffn_2" class="headerlink" title="2"></a><a href="#fn_2">2</a></sup>相关的知识计算。伯努利数序列并不具有直观含义，但其指数生成函数（EGF）为</p><script type="math/tex;mode=display">\hat{B}(x) = \frac{x}{e^x-1} = \sum_{i\ge 0}B_i \frac{x^i}{i!}</script><p>为了推导等幂求和的系数表示，我们先介绍伯努利多项式的定义：</p><script type="math/tex;mode=display">\beta_n(z)= \sum_{i=0}^n\binom{n}{i}B_iz^{n-i}</script><p>伯努利多项式实际上是一个序列<script type="math/tex">\beta_0(z), \beta_1(z), \cdots</script>，这个序列的每一个元素都是个多项式。</p><p>因此我们可以求出这个序列的指数生成函数（多项式序列的生成函数）：</p><script type="math/tex;mode=display">\hat{\mathbf{B}}_z(x) = \sum_{i\ge 0}\beta_i(z) \frac{x^i}{i!}</script><p>把<script type="math/tex">z</script>写成下标是因为这个生成函数中<script type="math/tex">x</script>作为主要的占位符。接下来我们推导其封闭形式：</p><script type="math/tex;mode=display">\begin{aligned}
\hat{\mathbf{B}}_z(x) = & \sum_{i\ge 0}\beta_i(z) \frac{x^i}{i!}\\
= & \sum_{i\ge 0} \frac{x^i}{i!} \sum_{j=0}^i\binom{i}{j}B_jz^{i-j} \\
= & \sum_{i\ge 0} \sum_{j=0}^i \frac{B_jx^j}{j!} \frac{z^{i-j}x^{i-j}}{(i-j)!} \\
= & \frac{x}{e^x-1}e^{zx}
\end{aligned}</script><p>接下来我们将其差分：</p><script type="math/tex;mode=display">\hat{\mathbf{B}}_{z+1}(x) - \hat{\mathbf{B}}_z(x) = \frac{x}{e^x-1}e^{(z+1)x} - \frac{x}{e^x-1}e^{zx} = xe^{zx}</script><p>这对应的是序列<script type="math/tex">\beta_i(z+1)-\beta_i(z)</script>的 EGF。将其展开得到</p><script type="math/tex;mode=display">xe^{zx} = \sum_{i\ge 0} \frac{z^ix^{i+1}}{i!} = \sum_{i\ge 0} z^i(i+1) \frac{x^{i+1}}{(i+1)!}</script><p>因此我们得到<script type="math/tex">\beta_{i+1}(z+1)-\beta_{i+1}(z) = z^i(i+1)</script>，即</p><script type="math/tex;mode=display">z^i = \frac{\beta_{i+1}(z+1)-\beta_{i+1}(z)}{i+1}</script><p>我们将<script type="math/tex">z^i</script>表示为了差分的形式，因此我们可以裂项相消：</p><script type="math/tex;mode=display">\begin{aligned}
\sum_{i=0}^n i^k &= \frac{1}{k+1}\sum_{i=0}^n \beta_{k+1}(i+1)-\beta_{k+1}(i)\\
&= \frac{\beta_{k+1}(n+1) - \beta_{k+1}(0)}{k+1} \\
&= \sum_{i=0}^{k+1}\binom{k+1}{i}B_i(n+1)^{k+1-i} - B_{k+1} \\
&= \sum_{i=0}^{k}\binom{k+1}{i}B_i(n+1)^{k+1-i}
\end{aligned}</script><p>这样我们就直接得到了<script type="math/tex">F_k(n)</script>的系数表示。</p><p><a id="fn_1" class="headerlink" title="1"></a><sup>1</sup>. <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Faulhaber%27s_formula">https://en.wikipedia.org/wiki/Faulhaber%27s_formula</a><a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#8617;</a></p><p><a id="fn_2" class="headerlink" title="2"></a><sup>2</sup>. <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-cn/%E4%BC%AF%E5%8A%AA%E5%88%A9%E6%95%B0">https://zh.wikipedia.org/zh-cn/%E4%BC%AF%E5%8A%AA%E5%88%A9%E6%95%B0</a><a href="#reffn_2" title="Jump back to footnote [2] in the text."> &#8617;</a></p></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2021年3月27日 第3次修订</li><li class="post-history-item">2021年3月27日 第2次修订</li><li class="post-history-item">2021年3月27日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/Math/Counting-Pro/">「草稿」组合计数综合练习</a></div><div class="prev-post"><a href="/Data-Structure/Long-Path-Decomposition/">长链剖分学习笔记 </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>