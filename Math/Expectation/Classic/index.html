<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>期望经典问题入门 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">期望经典问题入门</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2022年7月13日星期三下午5点09分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2022年7月13日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 7,561 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> <a class="directory" href="/directory/Math/">数学 </a><span class="icon smallarrow"></span> <a class="directory" href="/directory/Math/Expectation/">期望 </a><span class="icon smallarrow"></span> 当前文章</div><div class="post-tags"><span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Notes/">Notes</a></span> <span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Math/">Math</a></span> <span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Expectation/">Expectation</a></span></div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一些概念"><span class="toc-number">1.</span> <span class="toc-text">一些概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A"><span class="toc-number">2.</span> <span class="toc-text">A</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#B"><span class="toc-number">3.</span> <span class="toc-text">B</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-拿球"><span class="toc-number">4.</span> <span class="toc-text">C 拿球</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C1"><span class="toc-number">4.1.</span> <span class="toc-text">C1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C2"><span class="toc-number">4.2.</span> <span class="toc-text">C2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C3"><span class="toc-number">4.3.</span> <span class="toc-text">C3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#D-游走"><span class="toc-number">5.</span> <span class="toc-text">D 游走</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#D1"><span class="toc-number">5.1.</span> <span class="toc-text">D1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#D2"><span class="toc-number">5.2.</span> <span class="toc-text">D2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#D3"><span class="toc-number">5.3.</span> <span class="toc-text">D3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#D4"><span class="toc-number">5.4.</span> <span class="toc-text">D4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#D5"><span class="toc-number">5.5.</span> <span class="toc-text">D5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#D6"><span class="toc-number">5.6.</span> <span class="toc-text">D6</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#E-经典题"><span class="toc-number">6.</span> <span class="toc-text">E 经典题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#E1"><span class="toc-number">6.1.</span> <span class="toc-text">E1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E2"><span class="toc-number">6.2.</span> <span class="toc-text">E2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E3-1"><span class="toc-number">6.3.</span> <span class="toc-text">E3-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E3-2"><span class="toc-number">6.4.</span> <span class="toc-text">E3-2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E4"><span class="toc-number">6.5.</span> <span class="toc-text">E4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E5-1"><span class="toc-number">6.6.</span> <span class="toc-text">E5-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E5-2"><span class="toc-number">6.7.</span> <span class="toc-text">E5-2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E6"><span class="toc-number">6.8.</span> <span class="toc-text">E6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E7"><span class="toc-number">6.9.</span> <span class="toc-text">E7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E8"><span class="toc-number">6.10.</span> <span class="toc-text">E8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E9"><span class="toc-number">6.11.</span> <span class="toc-text">E9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E10"><span class="toc-number">6.12.</span> <span class="toc-text">E10</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#F-期望线性性练习题"><span class="toc-number">7.</span> <span class="toc-text">F 期望线性性练习题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#F1"><span class="toc-number">7.1.</span> <span class="toc-text">F1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#F2"><span class="toc-number">7.2.</span> <span class="toc-text">F2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#F3"><span class="toc-number">7.3.</span> <span class="toc-text">F3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#F4"><span class="toc-number">7.4.</span> <span class="toc-text">F4</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">8.</span> <span class="toc-text">总结</span></a></li></ol></div><hr></div><div class="post-content"><h2><a id="一些概念" href="#一些概念" class="headerlink" title="一些概念"></a>一些概念</h2><p>随机变量<script type="math/tex">X</script>：有多种可能取值的变量。</p><p><script type="math/tex">P(A)</script>：<script type="math/tex">A</script>事件发生的概率。</p><p><script type="math/tex">E(X)</script>：随机变量<script type="math/tex">X</script>的期望值，<script type="math/tex">E(X)=\sum_iP(X=i)\cdot i</script>。</p><p>独立事件：两个事件互不影响，满足<script type="math/tex">P(AB)=P(A)P(B),E(AB)=E(A)E(B)</script>。<br>证明：</p><script type="math/tex;mode=display">\begin{aligned}
E(AB)&=\sum_{i}\sum_jP(A=i\wedge B=j)\cdot i\cdot j\\
&=\sum_{i}\sum_jP(A=i)P(B=j)\cdot i\cdot j\\
&=E(A)E(B)
\end{aligned}</script><p>期望的线性性：对于任意两个随机变量<script type="math/tex">X,Y,E(X+Y)=E(X)+E(Y)</script>。<br>证明：</p><script type="math/tex;mode=display">\begin{aligned}
E(X+Y)&=\sum_i\sum_jP(X=i\wedge Y=j)(i+j)\\
&=\sum_i\sum_jP(X=i\wedge Y=j)i+\sum_i\sum_jP(X=i\wedge Y=j)j\\
&=\sum_ii\sum_jP(X=i\wedge Y=j)+\sum_jj\sum_iP(X=i\wedge Y=j)\\
&=\sum_ii\cdot P(X=i)+\sum_jj\cdot P(Y=j)\\
&=E(X)+E(Y)\\
\end{aligned}</script><p>前缀和技巧：对于离散变量（取值只有整数）x，<script type="math/tex">P(x=k)=P(x\le k)-P(x\le k-1)</script>。</p><h2><a id="A" href="#A" class="headerlink" title="A"></a>A</h2><blockquote><p>有 n 个随机变量<script type="math/tex">\langle X_i\rangle</script>，每个随机变量量都是从<script type="math/tex">[1,m]</script>中随机一个整数，求<script type="math/tex">\max\left\langle X_i\right\rangle</script>的期望。</p></blockquote><p>设<script type="math/tex">S=\max \left\langle x_i\right\rangle_{i=1}^n</script>，则我们要求的是<script type="math/tex">E(S)</script>。根据期望的定义式得到</p><script type="math/tex;mode=display">E(S)=\sum_{i=1}^mP(S=i)i</script><p>我们使用前缀和技巧，得到<script type="math/tex">P(S=i)=P(S\le i)-P(S\le i-1)</script>。然后我们推一波式子，你发现<script type="math/tex">S\le i</script>等价于<script type="math/tex">\left\langle x_j\right\rangle_{j=1}^n \le i</script>，那么就可以得到</p><script type="math/tex;mode=display">P(S\le i)=P(\left\langle x_i\right\rangle_{i=1}^n\le i)=\left(\frac{i}{m}\right)^n\\
P(S=i)=\left(\frac{i}{m}\right)^n-\left(\frac{i-1}{m}\right)^n\\</script><p>于是得到</p><script type="math/tex;mode=display">E(S)=\sum_{i=1}^mi\left(\left(\frac{i}{m}\right)^n-\left(\frac{i-1}{m}\right)^n\right)=m-\frac{1}{m^n}\sum_{i=1}^{m-1}i^n</script><h2><a id="B" href="#B" class="headerlink" title="B"></a>B</h2><blockquote><p>证明：概率为<script type="math/tex">p</script>的事件期望<script type="math/tex">\frac{1}{p}</script>次发生。</p></blockquote><p>设随机变量<script type="math/tex">x</script>表示这个事件在第<script type="math/tex">x</script>次发生。于是我们需要求<script type="math/tex">E(x)</script>。套公式得到</p><script type="math/tex;mode=display">\begin{aligned}
E(x)=&\sum_iP(x=i)i\\
E(x)=&\sum_i(P(x\ge i)-P(x\ge i+1))i\\
\end{aligned}</script><p>于是问题转化为我们要求<script type="math/tex">P(x\ge i)</script>，它表示这个事件在第<script type="math/tex">i</script>次及以后发生。显然它在前<script type="math/tex">i-1</script>次都未发生过，概率为<script type="math/tex">(1-p)^{i-1}</script>。因此得到</p><script type="math/tex;mode=display">\begin{aligned}
E(x)&=\sum_{i=1}^\infty ((1-p)^{i-1}-(1-p)^i)i\\
&=\sum_{i=0}^\infty(1-p)^i
\end{aligned}</script><p>根据小 Trick 得到</p><script type="math/tex;mode=display">E(x)=\frac{1}{1-(1-p)}=\frac{1}{p}</script><p>事实上，对于求期望，可以将其转化为求概率的和：</p><script type="math/tex;mode=display">\begin{aligned}
E(x)=&\sum_{i=1}^\infty P(x=i)\sum_{j=1}^i1\\
=&\sum_{j=1}^\infty\sum_{i\ge j} P(x=i)=\sum_{j=1}^\infty P(x\ge j)
\end{aligned}</script><h2><a id="C-拿球" href="#C-拿球" class="headerlink" title="C 拿球"></a>C 拿球</h2><h3><a id="C1" href="#C1" class="headerlink" title="C1"></a>C1</h3><blockquote><p>箱子里有<script type="math/tex">n</script>个球<script type="math/tex">1,2,\cdots, n</script>，你要从里面拿<script type="math/tex">m</script>次球，拿了后放回，求取出的数字之和的期望。</p></blockquote><p>这题是一个标准的一眼题。每次取的期望是一样的，所以很容易得到答案为<script type="math/tex">\dfrac{(n+1)m}{2}</script>。但我们还是严谨地做一下。</p><p>设随机变量<script type="math/tex">x_i</script>表示第 i 次取出来的值。那么数字之和的期望即为</p><script type="math/tex;mode=display">E\left(\sum_{i=1}^mx_i\right)=\sum_{i=1}^mE(x_i)</script><p>根据期望的定义得到</p><script type="math/tex;mode=display">E(x_i)=\sum_{j=1}^nP(x_i=j)j</script><p>于是我们要求<script type="math/tex">P(x=j)</script>的概率。显然不论<script type="math/tex">j</script>取何值，概率都是相等的，为<script type="math/tex">\dfrac{1}{n}</script>，因此得到</p><script type="math/tex;mode=display">E(x_i)=\sum_{j=1}^n\frac{j}{n}=\frac{1}{n}\frac{(n+1)n}{2}=\frac{n+1}{2}</script><p>于是答案即为<script type="math/tex">\dfrac{(n+1)m}{2}</script>。</p><h3><a id="C2" href="#C2" class="headerlink" title="C2"></a>C2</h3><blockquote><p>箱子里有<script type="math/tex">n</script>个球<script type="math/tex">1,2,\cdots, n</script>，你要从里面拿<script type="math/tex">m</script>次球，拿了后不放回，求取出的数字之和的期望。</p></blockquote><p>我们设随机变量<script type="math/tex">x_i</script>表示</p><script type="math/tex;mode=display">x_i=\begin{cases}
i&\text{if i is chosen}\\
0&\text{if i isn't chosen}
\end{cases}</script><p>设答案为<script type="math/tex">S</script>，得到<script type="math/tex">S=\displaystyle\sum_{i=1}^nx_i</script>，于是我们要求</p><script type="math/tex;mode=display">E(S)=E\left(\sum_{i=1}^nx_i\right)=\sum_{i=1}^nE(x_i)\\</script><p>展开<script type="math/tex">E(x_i)</script>得到</p><script type="math/tex;mode=display">E(x_i)=\sum_{j}P(x_i=j)j=P(x_i=i)i</script><p>显然<script type="math/tex">P(x_i=i)</script>表示<script type="math/tex">i</script>被取出的概率。而拿球后不放回，相当于在 n 个球中取 m 个，因此概率为<script type="math/tex">\dfrac{m}{n}</script>，于是得到</p><script type="math/tex;mode=display">E(x_i)=\frac{m}{n}\cdot i\\
E(S)=\sum_{i=1}^n\frac{m}{n}\cdot i=\frac{m(n+1)}{2}</script><h3><a id="C3" href="#C3" class="headerlink" title="C3"></a>C3</h3><blockquote><p>箱子里有<script type="math/tex">n</script>个球<script type="math/tex">1,2,\cdots, n</script>，你要从里面拿<script type="math/tex">m</script>次球，拿了后以<script type="math/tex">p_1</script>的概率放回，<script type="math/tex">p_2</script>的概率放回两个和这个相同的球（相当于增加一个球），求取出的数字之和的期望。</p></blockquote><p>我们仍然设一个随机变量<script type="math/tex">x_i</script>，它表示<script type="math/tex">i</script>被拿出来的次数乘<script type="math/tex">i</script>，即对答案的贡献。形式化地，我们设<script type="math/tex">y_i</script>表示<script type="math/tex">i</script>被拿了几次，那么<script type="math/tex">x_i=y_i\cdot i</script>。假设数字之和为<script type="math/tex">S</script>，那么</p><script type="math/tex;mode=display">\begin{aligned}
S&=\sum_{i=1}^nx_i\\
E(x_i)&=E(y_i)\cdot i\\
E(S)&=\sum_{i=1}^nE(y_i)\cdot i\\
\end{aligned}\\</script><p>然后我们考虑求<script type="math/tex">E(y_i)</script>。首先我们知道，每一个球是平等的，意味着概率是均等的，意味着它们被拿出来的次数的期望是一样的，即<script type="math/tex">E(y_1)=E(y_2)=\cdots=E(y_n)</script>。而我们知道，他们被拿出来的次数的和是<script type="math/tex">m</script>（因为你只拿了<script type="math/tex">m</script>个球出来），而<script type="math/tex">E(m)=m</script>，即</p><script type="math/tex;mode=display">E\left(\sum_{i=1}^ny_i\right)=\sum_{i=1}^nE(y_i)=m</script><p>因此得到<script type="math/tex">E(y_i)=\dfrac{m}{n}</script>，带回上式得到<script type="math/tex">E(S)=\dfrac{m(n+1)}{2}</script>。</p><h2><a id="D-游走" href="#D-游走" class="headerlink" title="D 游走"></a>D 游走</h2><h3><a id="D1" href="#D1" class="headerlink" title="D1"></a>D1</h3><blockquote><p>在一条<script type="math/tex">n</script>个点的链上游走，求从一端走到另一端的期望步数。</p></blockquote><p>假设步数是<script type="math/tex">S</script>，求<script type="math/tex">S</script>的期望。我们定义一个随机变量<script type="math/tex">x_i</script>表示从<script type="math/tex">i</script>出发随机游走，第一次到<script type="math/tex">i+1</script>的步数。</p><script type="math/tex;mode=display">\begin{aligned}
S&=\sum_{i=1}^{n-1}x_i\\
E(S)&=E\left(\sum_{i=1}^{n-2}x_i\right)=\sum_{i=1}^{n-1}E(x_i)\\
\end{aligned}</script><p>我们手推一下期望的式子，发现</p><script type="math/tex;mode=display">\begin{array}{l}
E(x_1)&=&1\\
E(x_2)&=&\frac{1}{2}+\frac{1}{2}(1+E(x_1)+E(x_2))&=&3\\
E(x_i)&=&\frac{1}{2}+\frac{1}{2}(1+E(x_{i-1})+E(x_i))&=&E(x_{i-1})+2
\end{array}</script><p>就可以递推做了。但算出来就会发现，<script type="math/tex">E(S)=(S-1)^2</script>。</p><h3><a id="D2" href="#D2" class="headerlink" title="D2"></a>D2</h3><blockquote><p>在一个<script type="math/tex">n</script>个点的完全图上游走，求从一个点走到另一个点的期望步数。</p></blockquote><p>设期望步数为<script type="math/tex">E</script>，得到</p><script type="math/tex;mode=display">E=\frac{1}{n-1}+\frac{n-2}{n-1}E+1</script><p>解得<script type="math/tex">E=n-1</script>。</p><h3><a id="D3" href="#D3" class="headerlink" title="D3"></a>D3</h3><blockquote><p>在一个<script type="math/tex">n</script>个点的完全二分图上游走，求从一个点走到另一个点的期望步数。</p></blockquote><p><script type="math/tex">E_1</script>表示异侧点的期望，<script type="math/tex">E_2</script>表示同侧点的期望。</p><script type="math/tex;mode=display">\begin{aligned}
E_1&=\frac{1}{n}+\frac{n-1}{n}(E_2 + 1)\\
E_2&=E_1+1\\
E_1&= 2n - 1
\end{aligned}</script><h3><a id="D4" href="#D4" class="headerlink" title="D4"></a>D4</h3><blockquote><p>在一个<script type="math/tex">n</script>个点的菊花图上游走，求从一个点走到另一个点的期望步数。</p></blockquote><p>类似的方法。</p><h3><a id="D5" href="#D5" class="headerlink" title="D5"></a>D5</h3><blockquote><p>在一棵<script type="math/tex">n</script>个点的树上游走，求从根走到<script type="math/tex">x</script>的期望步数。</p></blockquote><p>对每条边<script type="math/tex">(u\to v)</script>记录从<script type="math/tex">u</script>走到<script type="math/tex">v</script>的期望步数。<script type="math/tex">S_u</script>表示<script type="math/tex">u</script>的儿子数（有根树）</p><script type="math/tex;mode=display">\begin{aligned}
E(u,v)&=\frac{1}{|S_u|+1}+\sum_{(u\to v')\in E,v'\neq v}\frac{1}{|S_u|+1}(1+E(v',u)+E(u,v))\\
E(u,v)&=|S_u|+1+\sum_{(u\to v')\in E,v'\neq v}E(v',u)\\
\end{aligned}</script><p>怎么算这个式子？把<script type="math/tex">v</script>当作<script type="math/tex">u</script>的父节点，那么<script type="math/tex">v'</script>一定是<script type="math/tex">u</script>的子节点。这就是一个树形 DP。算完到 root 后再从根到子节点算一下向下走的边的期望。这题本来可以直接<script type="math/tex">f[u]</script>表示从<script type="math/tex">u</script>走到<script type="math/tex">u</script>的父节点的期望步数来 DP，但上述方法更可拓展（多组询问）。</p><h3><a id="D6" href="#D6" class="headerlink" title="D6"></a>D6</h3><blockquote><p>构造一张 200 个点的无向图, 使得上面从 S 走到 T 的随机游走期望步数大于等于 1000000 步。</p></blockquote><p>我们构造一个<script type="math/tex">n=100</script>个点的团，以及一个 100 个点的链，考虑他们的连接点<script type="math/tex">u</script>，则<script type="math/tex">u</script>沿着链走一步的期望步数为</p><script type="math/tex;mode=display">E(u)=\frac{1}{n}+\frac{n-1}{n}(n-1+E(u))\\
E(u)=1+(n-1)^2</script><p>而我们知道在链上走的期望，于是得到走到终点的总期望为</p><script type="math/tex;mode=display">\frac{(E(u)+E(u)+2n)(n+1)}{2}</script><p>可以达到要求。</p><h2><a id="E-经典题" href="#E-经典题" class="headerlink" title="E 经典题"></a>E 经典题</h2><h3><a id="E1" href="#E1" class="headerlink" title="E1"></a>E1</h3><blockquote><p>每次随机一个<script type="math/tex">[1,n]</script>的整数, 问期望几次能凑齐所有数。</p></blockquote><p>设<script type="math/tex">f[i]</script>表示凑齐了<script type="math/tex">i</script>个数，期望几次凑齐所有数。</p><script type="math/tex;mode=display">f[i]=\frac{i}{n}(f[i]+1)+\frac{n-i}{n}(f[i+1]+1)\\
f[i]=f[i+1]+\frac{n}{n-i}</script><p>有一个有趣的问题，就是这个问题的答案为什么不是每个数第一次被凑出的时间的和的期望？如果这样算那么<script type="math/tex">E(S)=n^2</script>。但事实上凑出的时间相当于次数的前缀和，因此是不对的。</p><h3><a id="E2" href="#E2" class="headerlink" title="E2"></a>E2</h3><blockquote><p>随机一个长度为<script type="math/tex">n</script>个排列<script type="math/tex">p</script>，求<script type="math/tex">\langle p_j\rangle_{j=1}^i</script>中<script type="math/tex">p_i</script>是最大的数的概率。</p></blockquote><p>其实这题很简单。由于每个数是均等的，因此他们成为最大值的概率也是一样的，于是答案为<script type="math/tex">\dfrac{1}{i}</script>。</p><h3><a id="E3-1" href="#E3-1" class="headerlink" title="E3-1"></a>E3-1</h3><blockquote><p>随机一个长度为<script type="math/tex">n</script>个排列<script type="math/tex">p</script>，求<script type="math/tex">\langle p_{j}\rangle_{j=1}^i</script>中<script type="math/tex">p_i</script>是最大的数的个数（即前缀最大值的个数）的期望。</p></blockquote><p>设随机变量<script type="math/tex">x_i</script></p><script type="math/tex;mode=display">x_i=\begin{cases}
1 & p_i=\max\left\langle p_j\right\rangle_{j=1}^i\\
0 & \text{Otherwise}
\end{cases}</script><p>则可以得到</p><script type="math/tex;mode=display">E(S)=\sum_{i=1}^nE(x_i)=\sum_{i=1}^nP(x_i=1)=\sum_{i=1}^n\frac{1}{i}</script><h3><a id="E3-2" href="#E3-2" class="headerlink" title="E3-2"></a>E3-2</h3><blockquote><p>随机一个长度为<script type="math/tex">n</script>个排列<script type="math/tex">p</script>，求<script type="math/tex">\langle p_{i}\rangle_{j=1}^i</script>中<script type="math/tex">p_i</script>是最大的数的个数（即前缀最大值的个数）的平方的期望。</p></blockquote><p>首先要明确一点，就是平方的期望不等于期望的平方，即<script type="math/tex">E(x^2)\ne E^2(x)</script>，因为<script type="math/tex">x</script>是随机变量不是常量。</p><p>于是我们按套路出牌，设随机变量<script type="math/tex">x_i</script></p><script type="math/tex;mode=display">x_i=\begin{cases}
1&p_i=\max \left\langle p_j\right\rangle_{j=1}^i\\
0&\text{Otherwise}
\end{cases}</script><p>于是我们得到</p><script type="math/tex;mode=display">E(S^2)=E\left(\left(\sum_{i=1}^nx_i\right)^2\right)=\sum_{i\ne j}E(x_ix_j)+\sum_{i=1}^nE(x_i^2)</script><p>由于<script type="math/tex">x_i\in\{0,1\}</script>，因此其实<script type="math/tex">x_i^2\Leftrightarrow x_i</script>，于是我们需要求<script type="math/tex">E(x_i)</script>。仔细理解一下，其实这就是<script type="math/tex">p_i=\max \left\langle p_j\right\rangle_{j=1}^i</script>的概率！于是我们得到<script type="math/tex">E(x_i)=\dfrac{1}{i}</script>。</p><p>接下来考虑<script type="math/tex">E(x_ix_j)</script>，在此之前我们思考一下<script type="math/tex">x_ix_j</script>的取值，有</p><script type="math/tex;mode=display">x_ix_j=\begin{cases}
1& (p_i=\max \left\langle p_k\right\rangle_{k=1}^i) \wedge( p_j=\max \left\langle p_k\right\rangle_{j=1}^i)\\
0& \text{otherwise}
\end{cases}</script><p>那么一个有趣的问题是，<script type="math/tex">p_i=\max \left\langle p_k\right\rangle_{k=1}^i</script>与<script type="math/tex">p_j=\max \left\langle p_k\right\rangle_{j=1}^i</script>两个事件是否相关？</p><p>答案是，他们不相关！不管他们是在何种情况下同时发生，要么 i&lt;j 要么 i&gt;j，其中一个总是覆盖另一个的范围，即比另一个的所有数都大，因此不会受到另一个的选择的影响。于是我们得到</p><script type="math/tex;mode=display">E(x_ix_j)=E(x_i)E(x_j)=\frac{1}{ij}</script><p>综上，我们得到</p><script type="math/tex;mode=display">E(S^2)=\sum_{i\ne j}\frac{1}{ij}+\sum_{i=1}^n\frac{1}{i}</script><h3><a id="E4" href="#E4" class="headerlink" title="E4"></a>E4</h3><blockquote><p>随机一个⻓度为<script type="math/tex">n</script>的排列<script type="math/tex">p</script>，求<script type="math/tex">i</script>在<script type="math/tex">j</script>的后面的概率。</p></blockquote><p>直观理解，<script type="math/tex">i</script>和<script type="math/tex">j</script>是平等的，因此谁在前面的概率是相等的，答案即为</p><script type="math/tex;mode=display">\begin{cases}
\frac{1}{2}&i\ne j\\
0&i=j
\end{cases}</script><h3><a id="E5-1" href="#E5-1" class="headerlink" title="E5-1"></a>E5-1</h3><blockquote><p>随机一个⻓度为 n 的排列<script type="math/tex">p</script>，求它包含<script type="math/tex">\left\langle w_i\right\rangle_{i=1}^m</script>作为子序列的概率。</p></blockquote><p>对于一个排列<script type="math/tex">p</script>，你把<script type="math/tex">w_i</script>中的元素抽出来，那么这一定是一个<script type="math/tex">w</script>的排列，而我们不关心其他的数的情况，因此概率显然为<script type="math/tex">\dfrac{1}{m!}</script>。一个有趣的问题是：根据之前的问题，<script type="math/tex">i</script>在<script type="math/tex">j</script>后面的概率是<script type="math/tex">\frac{1}{2}</script>，那这题的概率为什么不是<script type="math/tex">\frac{1}{2^{m-1}}</script>？原因是你想在一个数的后面接一个数，但它不一定放得了。</p><h3><a id="E5-2" href="#E5-2" class="headerlink" title="E5-2"></a>E5-2</h3><blockquote><p>随机一个⻓度为 n 的排列<script type="math/tex">p</script>，求它包含<script type="math/tex">\left\langle w_i\right\rangle_{i=1}^m</script>作为连续子序列的概率。</p></blockquote><p>我们设一个随机变量<script type="math/tex">x_i</script>，其中<script type="math/tex">i</script>表示一个排列<script type="math/tex">p</script>的情况，（相当于我们有<script type="math/tex">\dbinom{n}{m}m!</script>个随机变量）</p><script type="math/tex;mode=display">x_i=\begin{cases}
1&\left\langle w_i\right\rangle_{i=1}^m\text{ occurs as a continuous subsequence}\\
0&\text{Otherwise}
\end{cases}</script><p>由于<script type="math/tex">p</script>中出现连续的<script type="math/tex">w</script>做为子序列只有<script type="math/tex">n-m+1</script>种位置，因此我们设<script type="math/tex">T=\displaystyle\sum_{i=1}^{\binom{n}{m}m!}x_i=n-m+1</script>。现在我们想知道<script type="math/tex">w</script>做为连续子序列的概率，相当于求<script type="math/tex">x_i</script>的期望。而根据平等原则，每一种情况出现的概率是相等的，因此得到</p><script type="math/tex;mode=display">P(x_i=1)=E(x_i)=\frac{n-m+1}{\binom{n}{m}m!}</script><h3><a id="E6" href="#E6" class="headerlink" title="E6"></a>E6</h3><blockquote><p>有<script type="math/tex">n</script>堆石头，第<script type="math/tex">i</script>堆个数为<script type="math/tex">a_i</script>。每次随机选一个石头然后把那一整堆都扔了，求第<script type="math/tex">1</script>堆石头期望第几次被扔。</p></blockquote><p>设随机变量<script type="math/tex">x_i</script>表示第<script type="math/tex">i</script>堆石头是第几个被拿走的，显然我们有</p><script type="math/tex;mode=display">x_1=1+\sum_{i=2}^n[x_i&lt; x_1]</script><p>于是我们要求<script type="math/tex">E(x_1)</script>，根据期望的线性性转化为<script type="math/tex">E([x_i&lt;x_1])</script>，由于艾弗森括号表达式是一个布尔表达式，因此这个期望等价于<script type="math/tex">P(x_i&lt;x_1)</script>，于是得到</p><script type="math/tex;mode=display">E(x_1)=1+\sum_{i=2}^nP(x_i&lt;x_1)</script><p>而根据 E4，我们稍作拓展，其实<script type="math/tex">\dfrac{a_i}{\sum_{i=1}^na_i}</script>表示的就是第<script type="math/tex">i</script>堆石子被拿走的概率。因此<script type="math/tex">P(x_i&lt;x_1)</script>表示的就是第<script type="math/tex">i</script>堆石子比第<script type="math/tex">1</script>堆石子先被拿走的概率，显然为<script type="math/tex">\dfrac{a_i}{a_i+a_1}</script>，于是得到</p><script type="math/tex;mode=display">E(x_1)=1+\sum_{i=2}^n\frac{a_i}{a_i+a_1}</script><h3><a id="E7" href="#E7" class="headerlink" title="E7"></a>E7</h3><blockquote><p>随机一个长度为<script type="math/tex">n</script>的 01 串，每个位置是<script type="math/tex">1</script>的概率是<script type="math/tex">p</script>，定义<script type="math/tex">S</script>是每段连续的<script type="math/tex">1</script>的⻓度的平方之和，求<script type="math/tex">S</script>的期望。</p></blockquote><p>令<script type="math/tex">x_i</script>表示<script type="math/tex">\left\langle s_j\right\rangle_{j=1}^i</script>中所有为<script type="math/tex">1</script>的段的长度的平方之和，因此<script type="math/tex">E(S)=E(x_n)</script>。再令<script type="math/tex">y_i</script>表示<script type="math/tex">\left\langle s_j\right\rangle_{j=1}^i</script>中最后一段<script type="math/tex">1</script>的长度。我们先求<script type="math/tex">x_i,y_i</script>的转移式。考虑第<script type="math/tex">i</script>位上的值。</p><script type="math/tex;mode=display">\begin{aligned}
&y_i=\begin{cases}
0&s_i=0\\
y_{i-1}+1&s_i=1
\end{cases}\\
&x_i=\begin{cases}
x_{i-1}&s_i=0\\
x_{i-1}-y_{i-1}^2+(y_{i-1}+1)^2=x_{i-1}+2y_{i-1}+1&s_i=1
\end{cases}
\end{aligned}</script><p>于是我们考虑求<script type="math/tex">E(x_i),E(y_i)</script>，于是我们简单地把概率套到上面的转移式就能得到</p><script type="math/tex;mode=display">\begin{aligned}
E(y_i)&=p(E(y_{i-1})+1)\\\\
E(x_i)&=p(E(x_{i-1})+2E(y_{i-1})+1)+(1-p)E(x_{i-1})\\
&=E(x_{i-1})+2pE(y_{i-1})+p
\end{aligned}</script><h3><a id="E8" href="#E8" class="headerlink" title="E8"></a>E8</h3><blockquote><p>给一个序列<script type="math/tex">1,2,\cdots,n</script>，每次随机删除一个元素, 问<script type="math/tex">i</script>和<script type="math/tex">j</script>在过程中相邻的概率。</p></blockquote><p>直接组合计数一波，相当于考虑一个排列中<script type="math/tex">i,j</script>相邻的概率。我们只用考虑他们中间的数，不用关心外面的数，于是得到</p><script type="math/tex;mode=display">P=\frac{(j-i-1)!2!}{(j-i+1)!}=\frac{1}{\binom{j-i+1}{2}}</script><h3><a id="E9" href="#E9" class="headerlink" title="E9"></a>E9</h3><blockquote><p>给定一棵树，将他的边随机一个顺序后依次插入，求<script type="math/tex">u,v</script>期望什什么时候连通。</p></blockquote><p>那么我们只需要考虑在插入边的序列中，<script type="math/tex">u,v</script>路径上出现时间最晚的边的位置（位置即时间）的期望。</p><p>假设<script type="math/tex">u,v</script>路径长度为<script type="math/tex">k</script>，总边数是<script type="math/tex">n-1</script>，那么枚举最后一条边的位置<script type="math/tex">i</script>，那么首先我们考虑剩下<script type="math/tex">k-1</script>条边的选法，然后是这<script type="math/tex">k</script>条边的顺序，然后是剩下的<script type="math/tex">n-k-1</script>条边的顺序（总共<script type="math/tex">n-1</script>条边），最后除以全排列即可。</p><script type="math/tex;mode=display">\frac{\sum_{i=k}^{n-1}k!\binom{i-1}{k-1}(n-k-1)!}{(n-1)!}</script><h3><a id="E10" href="#E10" class="headerlink" title="E10"></a>E10</h3><blockquote><p>给<script type="math/tex">1,2,\cdots,n</script>这<script type="math/tex">n</script>个数，每次随机选择一个还在的数，删掉他的所有约数。求期望几次删完。</p></blockquote><p>直接做的话，每一次删掉的数的个数不方便统计，不妨换一下思路。我们考虑这个问题：<br>给<script type="math/tex">1,2,\cdots,n</script>这<script type="math/tex">n</script>个数，初始时每个数都是白的。每次随机选择一个还在的数，如果它是黑的就删掉它，否则就把它的约数标黑再删掉它。求期望删掉几个白色的数。</p><p>仔细思考可以发现，这个问题与原问题是等价的。原因是删除黑色的点不影响白色点被选到的概率。这样转化的好处在于，我们每次只会删掉一个数。于是我们可以定义随机变量<script type="math/tex">x_i</script>表示</p><script type="math/tex;mode=display">x_i=\begin{cases}
1&\text{The i-th number is white}\\
0&\text{The i-th number is black}
\end{cases}</script><p>（注意，这里的第<script type="math/tex">i</script>个数是指删到第<script type="math/tex">i</script>个数时这个数的颜色）于是我们要求的是</p><script type="math/tex;mode=display">E(S)=\sum_{i=1}^nE(x_i)</script><p>根据这个随机变量的定义，<script type="math/tex">E(x_i)\Leftrightarrow P(x_i=1)</script>，于是我们要求<script type="math/tex">i</script>被删时是白色的概率。显然如果<script type="math/tex">i</script>是白色，那么<script type="math/tex">i</script>的所有倍数都没被删，且为白色。我们选到不是<script type="math/tex">i</script>的倍数时，对<script type="math/tex">i</script>的概率不影响，我们只需要考虑这<script type="math/tex">\left\lfloor\dfrac{n}{i}\right\rfloor</script>个数中<script type="math/tex">i</script>最先被选中的概率。显然为<script type="math/tex">\dfrac{1}{\left\lfloor\frac{n}{i}\right\rfloor}</script>，于是得到</p><script type="math/tex;mode=display">E(S)=\sum_{i=1}^nE(x_i)=\sum_{i=1}^n\frac{1}{\left\lfloor\frac{n}{i}\right\rfloor}</script><h2><a id="F-期望线性性练习题" href="#F-期望线性性练习题" class="headerlink" title="F 期望线性性练习题"></a>F 期望线性性练习题</h2><h3><a id="F1" href="#F1" class="headerlink" title="F1"></a>F1</h3><blockquote><p>给定<script type="math/tex">n</script>个硬币，第<script type="math/tex">i</script>个硬币的价值为<script type="math/tex">w_i</script>，每次随机取走一个硬币，获得的收益是左右两个硬币的价值的乘积，求期望总价值。</p></blockquote><p>设随机变量<script type="math/tex">x_{i,j}</script>表示</p><script type="math/tex;mode=display">x_{i,j}=\begin{cases}
1&i,j\text{ contributed}\\
0&\text{Otherwise}
\end{cases}</script><p>总价值为<script type="math/tex">S=\displaystyle\sum_{i&lt;j}x_{i,j}w_iw_j</script>，于是得到<script type="math/tex">E(S)=\displaystyle\sum_{i&lt;j}E(x_{i,j})w_iw_j</script>，问题转化为求<script type="math/tex">P(x_{i,j}=1)</script>，显然就是这两个数相邻的概率，相当于是说中间的数都在他们前面被删完的概率，于是把这<script type="math/tex">j-i+1</script>个数抽出来，那么<script type="math/tex">i,j</script>排最后的概率就是<script type="math/tex">\dfrac{2}{(j-i+1)(j-i)}</script>。于是得到</p><script type="math/tex;mode=display">E(S)=\sum_{i&lt;j}\frac{2w_iw_j}{(j-i+1)(j-i)}</script><h3><a id="F2" href="#F2" class="headerlink" title="F2"></a>F2</h3><blockquote><p>有<script type="math/tex">N</script>个数<script type="math/tex">\left\langle a_i\right\rangle_{i=1}^n</script>，每次等概率选出两个数，然后合并成一个新的数放回来，得到的收益是新的数的值，求总收益的期望。</p></blockquote><p>我们设随机变量<script type="math/tex">x_i</script>表示<script type="math/tex">a_i</script>对答案的贡献次数，显然收益为<script type="math/tex">S=\displaystyle\sum_{i=1}^nx_ia_i</script>。一波套路转化为求<script type="math/tex">E(x_i)</script>。要求期望的贡献次数，就是求期望的合并次数。每次合并都会减少一个数，而在<script type="math/tex">k</script>个数中选两个数，选到包含<script type="math/tex">a_i</script>的概率是<script type="math/tex">\dfrac{2}{k}</script>，于是就可以统计每次合并的期望，得到</p><script type="math/tex;mode=display">E(x_i)=\sum_{j=1}^{n-1}\frac{2}{n-j+1}\\</script><p>于是收益期望为</p><script type="math/tex;mode=display">E(S)=\sum_{i=1}^na_i\sum_{j=1}^{n-1}\frac{2}{n-j+1}</script><h3><a id="F3" href="#F3" class="headerlink" title="F3"></a>F3</h3><blockquote><p>给定一个数列<script type="math/tex">\left\langle w_i\right\rangle_{i=1}^n</script>，随机一个排列<script type="math/tex">H</script>，如果<script type="math/tex">H_i</script>比<script type="math/tex">H_{i-1}</script>和<script type="math/tex">H_{i+1}</script>都大，就获得<script type="math/tex">w_i</script>的收益，求期望收益。</p></blockquote><p>设随机变量<script type="math/tex">x_i</script></p><script type="math/tex;mode=display">x_i=\begin{cases}
1 & h_i&gt;\max (h_{i-1},h_{i+1})\\
0 & \text{Otherwise}
\end{cases}</script><p>得到<script type="math/tex">S=\displaystyle\sum_{i=1}^nx_iw_i</script>，一波套路转化为求<script type="math/tex">P(x_i=1)</script>，即相邻三个数中中间的数最大的概率。众生平等，答案为<script type="math/tex">\dfrac{1}{3}</script>，如果在边上就为<script type="math/tex">\dfrac{1}{2}</script>。于是计算一下答案即可。</p><h3><a id="F4" href="#F4" class="headerlink" title="F4"></a>F4</h3><blockquote><p>给出一棵树, 一开始每个点都是白的, 每次选一个白点将他子树里所有点染黑，求期望几次染黑整个树。</p></blockquote><p>染黑相当于删除，问题转化为每个点在它到根的路径上的点集中最先被删的概率，答案为</p><script type="math/tex;mode=display">E(S)=\sum_{i=1}^n\frac{1}{dep_x}</script><h2><a id="总结" href="#总结" class="headerlink" title="总结"></a>总结</h2><p>需要使用期望的性质解决的问题，通常都可以设出随机变量，并利用期望转概率、前缀和（容斥）、组合计数等技巧去解决。在解题的过程中也要灵活应用，重在理解题目的含义，发掘一些性质。</p></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2022年7月13日 第3次修订</li><li class="post-history-item">2022年7月8日 第2次修订</li><li class="post-history-item">2020年5月19日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/Probset/NOI2020/">NOI2020 补题记录</a></div><div class="prev-post"><a href="/Probset/BJOI2019/">BJOI 2019 </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>