<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>BJOI 2019 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">BJOI 2019</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2022年8月5日星期五下午3点32分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2022年8月5日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 3,086 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> <a class="directory" href="/directory/Probset/">训练题单 </a><span class="icon smallarrow"></span> 当前文章</div><div class="post-tags"><span class="tag"><span class="meta-icon iconfont icon-tag"></span><a class="tag" href="/tags/Complete-Solution/">Complete-Solution</a></span></div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#奥术神杖"><span class="toc-number">1.</span> <span class="toc-text">奥术神杖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#光线"><span class="toc-number">2.</span> <span class="toc-text">光线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#勘破神机"><span class="toc-number">3.</span> <span class="toc-text">勘破神机</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#A-部分"><span class="toc-number">3.1.</span> <span class="toc-text">A 部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B-部分"><span class="toc-number">3.2.</span> <span class="toc-text">B 部分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#排兵布阵"><span class="toc-number">4.</span> <span class="toc-text">排兵布阵</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#送别"><span class="toc-number">5.</span> <span class="toc-text">送别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删数"><span class="toc-number">6.</span> <span class="toc-text">删数</span></a></li></ol></div><hr></div><div class="post-content"><h2><a id="奥术神杖" href="#奥术神杖" class="headerlink" title="奥术神杖"></a>奥术神杖</h2><blockquote><p>给你一个长度为<script type="math/tex">n</script>的串<script type="math/tex">T</script>，字符集为<code class="inline-code">1234567890.</code>。另外给你<script type="math/tex">m</script>个小串<script type="math/tex">s_i</script>，字符集为<code class="inline-code">1234567890</code>。每个小串有一个权值，对应为<script type="math/tex">v_i</script>。设<script type="math/tex">f(x)</script>表示<script type="math/tex">s_x</script>在<script type="math/tex">T</script>中出现的次数。现在要求你把<script type="math/tex">T</script>中<strong>所有</strong>的<code class="inline-code">.</code>替换为一个数字。设<script type="math/tex">C=\sum_{i=1}^mf(i)</script>，则要求你在替换后，最大化<script type="math/tex">\sqrt[C]{\prod_{i=1}^mv_i^{f(i)}}</script>。不用输出答案，输出任意一个替换方案。</p><p><script type="math/tex">n,m,\sum s_i\le 1501, v_i\le 10^9</script>。</p></blockquote><p><strong>摘要：对数，二分，AC 自动机上 DP，精度。</strong></p><p>设答案为<script type="math/tex">ans</script>，则做一下对数可以变成<script type="math/tex">\ln ans = \frac{1}{c}\sum f(i)\ln v_i</script>，就是一个经典的 01 分数规划问题了。你把<script type="math/tex">f(i)\ln v_i</script>理解为是<script type="math/tex">f(i)</script>个<script type="math/tex">\ln v_i</script>。设<script type="math/tex">mid=\ln ans</script>，那么得到<script type="math/tex">\sum (\ln v_i-mid)</script>。就可以二分了。</p><p>相当于，字符串每一次出现的权值变成了<script type="math/tex">\ln v_i-mid</script>，问是否存在一个替换方案使得权值和大于 0（or 小于）。这个可以对<script type="math/tex">s_i</script>建立 AC 自动机后 DP，设<script type="math/tex">F(i,j)</script>表示<script type="math/tex">T[1,i]</script>对应 AC 自动机上的状态<script type="math/tex">j</script>时的最大权值和。转移的时候记一下前驱和方案即可。</p><p>注意精度，大于 0 要写成大于 eps。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/luogu/5319.cpp">代码</a></p><h2><a id="光线" href="#光线" class="headerlink" title="光线"></a>光线</h2><blockquote><p>有<script type="math/tex">n</script>层玻璃。第<script type="math/tex">i</script>层玻璃的透光率和反光率分别是<script type="math/tex">a_i\%,b_i\%</script>。问<script type="math/tex">n</script>层玻璃从上到下依次叠一起时，从上到下的透光率。</p><p><script type="math/tex">n\le 10^5,1\le a_i+b_i\le 100</script>。</p></blockquote><p><strong>摘要：叠一起后，你从上往下和从下往上就是不对称的情况（如果只有一层玻璃仍然是对称的）。</strong></p><p>设<script type="math/tex">f(i)</script>表示前 i 个玻璃叠一起时，从上往下的透光率。答案就是<script type="math/tex">f(n)</script>。特别地，<script type="math/tex">f(0)=1</script>。</p><p>如何转移？考虑从<script type="math/tex">f(i-1)</script>转移到<script type="math/tex">f(i)</script>，相当于我们这一束光先透过前<script type="math/tex">i-1</script>层玻璃，然后透过第<script type="math/tex">i</script>层。但是会有一部分光反弹回第<script type="math/tex">i-1</script>层玻璃上去，这部分又可能弹回来。</p><p>因此我们还需要再设<script type="math/tex">g(i)</script>表示前 i 个玻璃，从下往上的反光率。这样我们就可以得到</p><script type="math/tex;mode=display">\begin{aligned}
f(i)&=f(i-1)(a_i+b_ig(i-1)a_i+(b_ig(i-1))^2a_i+\cdots)\\
&=f(i-1)a_i\sum_{j\ge 0}(b_ig(i-1))^j
\end{aligned}</script><p>由于<script type="math/tex">b_ig(i-1)\le 1</script>，因此无穷级数可以化简封闭形式。类似地，<script type="math/tex">g(i)</script>也从<script type="math/tex">g(i-1)</script>转移：</p><script type="math/tex;mode=display">g(i)=b_i+g(i-1)a_i^2\sum_{j\ge 0}(b_ig(i-1))^j</script><p>时间复杂度<script type="math/tex">O(n\log_2n)</script>。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/luogu/5323.cpp">代码</a></p><h2><a id="勘破神机" href="#勘破神机" class="headerlink" title="勘破神机"></a>勘破神机</h2><blockquote><p>题意：设<script type="math/tex">F(n)</script>表示用多米诺骨牌填满<script type="math/tex">2\times n</script>的矩阵的方案数，<script type="math/tex">G(n)</script>表示用多米诺骨牌填满<script type="math/tex">3\times n</script>的矩阵的方案数。给出<script type="math/tex">l,r,k</script>，请分别求出<script type="math/tex">A,B</script>：</p><script type="math/tex;mode=display">A=\frac{1}{r-l+1}\sum_{n=l}^r\binom{F(n)}{k}\\
B=\frac{1}{r-l+1}\sum_{n=l}^r\binom{G(n)}{k}</script><p>对 998244353 取模。</p><p><script type="math/tex">T\le 5,l\le r\le 10^{18},k\le 501</script>。（<script type="math/tex">T</script>组数据）</p></blockquote><p><strong>摘要：斯特林反演下降幂转普通幂，特征方程求通项公式，然后做等式数列求和。要对根号扩域。</strong></p><h3><a id="A-部分" href="#A-部分" class="headerlink" title="A 部分"></a>A 部分</h3><p>对于<script type="math/tex">A</script>，可以先转化为求<script type="math/tex">\sum_{i=0}^n\binom{F(i)}{k}</script>，然后有</p><script type="math/tex;mode=display">\sum_{i=0}^n\binom{F(i)}{k}
=\frac{1}{k!}\sum_{i=0}^n F(i)^{\underline{k}}</script><p>根据第二类斯特林数的普通幂转下降幂，再套一个斯特林反演上去就可以反过来做：</p><script type="math/tex;mode=display">x^{\underline{k}}=\sum_{i=0}^k(-1)^{k-i}s(k,i)x^i</script><p>于是得到</p><script type="math/tex;mode=display">\sum_{i=0}^n F(i)^{\underline{k}}=\sum_{j=0}^k(-1)^{k-j}s(k,j)\sum_{i=0}^nF(i)^j</script><p>我们要快速算后面这部分，就得再做更多转化。容易发现<script type="math/tex">F(n)=F(n-1)+F(n-2)</script>且<script type="math/tex">F(0)=F(1)=1</script>，相当于是一个斐波那契数列（其实<script type="math/tex">F(i)=F_{i+1}</script>，移了一位）。由于</p><script type="math/tex;mode=display">F_n=\frac{1}{\sqrt{5}}\left(\frac{1+\sqrt{5}}{2}\right)^n-\frac{1}{\sqrt{5}}\left(\frac{1-\sqrt{5}}{2}\right)^n</script><p>设<script type="math/tex">A=\frac{1}{\sqrt{5}},x=\left(\frac{1+\sqrt{5}}{2}\right),B=-\frac{1}{\sqrt{5}},y=\left(\frac{1-\sqrt{5}}{2}\right)</script>，于是我们得到</p><script type="math/tex;mode=display">\begin{aligned}
\sum_{i=0}^nF(i)^j
&=\sum_{i=1}^{n+1}F_{i}^j\\
&=\sum_{i=1}^{n+1}(Ax^i+By^i)^j\\
&=\sum_{i=1}^{n+1}\sum_{d=0}^j\binom{j}{d}A^dx^{id}B^{j-d}y^{i(j-d)}\\
&=\sum_{d=0}^j\binom{j}{d}A^dB^{j-d}\sum_{i=1}^{n+1}(x^{d}y^{j-d})^i\\
\end{aligned}</script><p>后面是个等比数列求和，可以写成封闭形式加速。</p><p>做到这里看似没有问题。但是<script type="math/tex">\sqrt{5}</script>在模 998244353 意义下不是二次剩余！但这也不难。我们对数扩域，把每个数表示成<script type="math/tex">a+b\sqrt{5}</script>的形式即可。最后算出来的答案一定满足<script type="math/tex">b=0</script>。因此不必担心。</p><h3><a id="B-部分" href="#B-部分" class="headerlink" title="B 部分"></a>B 部分</h3><p><script type="math/tex">B</script>的难点在于递推式的推导。容易发现<script type="math/tex">G(n)</script>在<script type="math/tex">n</script>为奇数时等于<script type="math/tex">0</script>，因此我们设<script type="math/tex">g_n=G(2n)</script>。我们尝试推导<script type="math/tex">g_n</script>的递推式。</p><p>经过一番推导可以发现<script type="math/tex">g_n=4g_{n-1}-g_{n-2}</script>。然后解一下特征方程就得到了</p><script type="math/tex;mode=display">g_n=\left(\frac{1}{2}+\frac{\sqrt{3}}{6}\right)(2+\sqrt{3})^n+\left(\frac{1}{2}-\frac{\sqrt{3}}{6}\right)(2-\sqrt{3})^n</script><p>这样就可以求答案了。注意有点小细节，就是在这里是没有移一位的，所以<script type="math/tex">i\in[0,n]</script>而不是<script type="math/tex">[1,n+1]</script>。</p><p>时间复杂度<script type="math/tex">O(k^2\log_2n)</script>。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/luogu/5320.cpp">代码</a></p><h2><a id="排兵布阵" href="#排兵布阵" class="headerlink" title="排兵布阵"></a>排兵布阵</h2><blockquote><p>你有一个<script type="math/tex">s\times n</script>的非负整数矩阵<script type="math/tex">A</script>，满足<script type="math/tex">\forall i\in[1,s],\sum_{j=1}^nA_{ij}\le m</script>。你可以任意构造一个长度为<script type="math/tex">n</script>的非负整数序列<script type="math/tex">B</script>，使得<script type="math/tex">\sum_{i=1}^nB_i\le m</script>。你的序列的权值为</p><script type="math/tex;mode=display">\sum_{i=1}^s\sum_{j=1}^n [2A_{ij}&lt;B_j]j</script><p>求最大权值。</p><p><script type="math/tex">n,s\le 100,m\le 20000</script>。</p></blockquote><p><strong>摘要：简单 DP。</strong></p><p>发现每一列是独立的，把每一列的当作一组背包起来即可。</p><p>换一个说法，你想一个时间复杂度为<script type="math/tex">O(nms)</script>的算法就随便过了。</p><p>写的时候想写一个小优化，结果边界没处理好被卡 90 了好久……</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/luogu/5322.cpp">代码</a></p><h2><a id="送别" href="#送别" class="headerlink" title="送别"></a>送别</h2><blockquote><p><a target="_blank" rel="noopener" href="https://loj.ac/problem/3091">题面太长</a>。</p></blockquote><p><strong>摘要：估计是让你送别 OI 才出的这道题。</strong></p><p>把一堵墙拆成两条并列的边。那么摸着墙走相当于在边上走。</p><p>进一步发现，整个图一定由若干个环构成。</p><p>于是我们用平衡树维护环，对于询问操作就先看他们在不在一个环上，在就查询距离，不在就输出 -1。</p><p>修改操作相当于要考虑加一个环，删一个环，把两个环连起来，把环断开。讨论即可。</p><p>时间复杂度<script type="math/tex">O((nm+q)\log_2(nm))</script>。平均代码复杂度 7k。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/luogu/5321.cpp">代码</a></p><h2><a id="删数" href="#删数" class="headerlink" title="删数"></a><a target="_blank" rel="noopener" href="https://loj.ac/problem/3094">删数</a></h2><blockquote><p>对于任意一个数列，如果能在有限次进行下列删数操作后将其删为空数列，则称这个数列可以删空。一次删数操作定义如下：记当前数列长度为<script type="math/tex">k</script>，则删掉数列中所有等于<script type="math/tex">k</script>的数。</p><p>现在有一个长度为<script type="math/tex">n</script>的数列<script type="math/tex">a</script>，有<script type="math/tex">m</script>次修改操作：</p><ul><li>单点修改；</li><li>所有数<script type="math/tex">\pm 1</script>。</li></ul><p>求第<script type="math/tex">i</script>次修改后的<script type="math/tex">a</script>，至少需要修改几个数才能删空？</p><p><script type="math/tex">n,m\le 1.5\times 10^5,1\le a_i\le n</script>。</p></blockquote><p><span class="label">线段树</span> <span class="label">构造</span></p><p>对于一个静态的序列如何求出答案？</p><p>考虑建立权值数组，<script type="math/tex">c_i</script>表示<script type="math/tex">i</script>的出现次数。那么不妨把<script type="math/tex">c_i</script>当成一摞方块，那么我们把这个柱子向左平推推倒，这样会覆盖<script type="math/tex">[i-c_i+1,i]</script>。对每个权值这样操作后，没有被覆盖的位置的个数就是答案。证明：从合法性和最优性两个角度。</p><p>那么对于修改操作，所有数<script type="math/tex">\pm 1</script>相当于是数组的平移，记个指针就行。单点修改也很好维护。</p><p>使用线段树维护。时间复杂度<script type="math/tex">O((n+m)\log_2n)</script>。</p></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2022年8月5日 第3次修订</li><li class="post-history-item">2021年2月11日 第2次修订</li><li class="post-history-item">2020年4月24日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/Math/Expectation/Classic/">期望经典问题入门</a></div><div class="prev-post"><a href="/Constructive/">构造题选讲 </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>