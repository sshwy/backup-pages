<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>搜索复习 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">搜索复习</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2023年4月29日星期六下午5点50分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2023年4月29日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 4,292 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> 当前文章</div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#A-算法"><span class="toc-number">1.</span> <span class="toc-text">A* 算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#爬山算法"><span class="toc-number">2.</span> <span class="toc-text">爬山算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模拟退火"><span class="toc-number">3.</span> <span class="toc-text">模拟退火</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#约束满足问题与最小冲突算法。"><span class="toc-number">4.</span> <span class="toc-text">约束满足问题与最小冲突算法。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Minimax-搜索"><span class="toc-number">5.</span> <span class="toc-text">Minimax 搜索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Alpha-Beta-剪枝"><span class="toc-number">6.</span> <span class="toc-text">Alpha-Beta 剪枝</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Monte-Carlo-树搜索"><span class="toc-number">7.</span> <span class="toc-text">Monte Carlo 树搜索</span></a></li></ol></div><hr></div><div class="post-content"><p>搜索复习，但是 Rust。</p><p>在描述各类搜索算法之前，我们先给出一个通用的问题定义：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">Problem</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">State</span><span class="token punctuation">:</span> <span class="token class-name">State</span> <span class="token operator">+</span> <span class="token class-name">Trans</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Action</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">Action</span><span class="token punctuation">:</span> <span class="token class-name">Clone</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">init_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">State</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">actions_of</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">State</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Action</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2><a id="A-算法" href="#A-算法" class="headerlink" title="A* 算法"></a>A* 算法</h2><p>A* 算法的框架其实就是 Dijkstra 算法求解最短路。在这个算法中，问题的每个状态都有一个估价，<br>我们希望求出满足条件的代价最小的状态。为此我们定义搜索树上的结点为</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">Sized</span> <span class="token operator">+</span> <span class="token class-name">Copy</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">create</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token punctuation">::</span><span class="token class-name">State</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token class-name">P</span><span class="token punctuation">::</span><span class="token class-name">State</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">extend</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token punctuation">::</span><span class="token class-name">Action</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下来我们定义维护开结点的数据结构</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">FrontierSet</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">>></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">remove_with_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">P</span><span class="token punctuation">::</span><span class="token class-name">State</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">N</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">empty</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">push</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> node<span class="token punctuation">:</span> <span class="token class-name">N</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">pop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">N</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后就可以描述 A* 算法为：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">a_star_search</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">></span> <span class="token operator">+</span> <span class="token class-name">Cost</span><span class="token punctuation">,</span> <span class="token class-name">Q</span><span class="token punctuation">:</span> <span class="token class-name">FrontierSet</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token operator">>></span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">N</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> frontier <span class="token operator">=</span> <span class="token class-name">Q</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    frontier<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">init_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> explored<span class="token punctuation">:</span> <span class="token class-name">HashSet</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">::</span><span class="token class-name">State</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">HashSet</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">loop</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> frontier<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">break</span> <span class="token class-name">None</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">let</span> node <span class="token operator">=</span> frontier<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> node<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_terminal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">break</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        explored<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> action <span class="token keyword">in</span> p<span class="token punctuation">.</span><span class="token function">actions_of</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> child <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token operator">!</span>explored<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                frontier<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>frontier_node<span class="token punctuation">)</span> <span class="token operator">=</span> frontier<span class="token punctuation">.</span><span class="token function">remove_with_state</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> child<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> frontier_node<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        frontier<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        frontier<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>frontier_node<span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>UCS 只根据之前花费的代价<script type="math/tex">g(n)</script>搜索，贪婪搜索只根据当前状态到达目标的估价<script type="math/tex">h(n)</script>搜索。<br>而 A* 算法则同时考虑这两者，也就是说 A* 算法中一个状态的估价为<script type="math/tex">f(n) = g(n) + h(n)</script>。<br>此时的<script type="math/tex">f(n)</script>被称为启发式函数。</p><p>只要保证对未来的估计<script type="math/tex">h(n) \le</script>未来的真实代价，就能证明 A* 会找到最优解（可采纳）。</p><h2><a id="爬山算法" href="#爬山算法" class="headerlink" title="爬山算法"></a>爬山算法</h2><p>朴素的爬山算法会选择走到当前相邻状态中估价最高的状态，然后继续爬山。这里给出一些辅助的 trait：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">ArgMax</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">arg_max</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token keyword">impl</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>以及对应的实现</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token class-name">ArgMax</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">arg_max</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token keyword">impl</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">max_by</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>a<span class="token punctuation">,</span> b<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">partial_cmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">*</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样我们就可以描述爬山算法了：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">hill_climbing</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">></span> <span class="token operator">+</span> <span class="token class-name">Cost</span><span class="token operator">></span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">N</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> cur<span class="token punctuation">:</span> <span class="token class-name">N</span> <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">init_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">loop</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> neighbor <span class="token operator">=</span> p
            <span class="token punctuation">.</span><span class="token function">actions_of</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>a<span class="token closure-punctuation punctuation">|</span></span> cur<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">N</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">arg_max</span><span class="token punctuation">(</span><span class="token class-name">Cost</span><span class="token punctuation">::</span>cost<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">cloned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>neighbor<span class="token punctuation">)</span> <span class="token operator">=</span> neighbor <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> neighbor<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> cur<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            cur <span class="token operator">=</span> neighbor
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    cur
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但可以明显发现上述算法不是很完备。为此衍生了很多变种：</p><ul><li>随机平移：遇到平台时不直接退出，而是随机跳到一个邻居上（有一个次数上限）。</li><li>随机爬山：随机跳到更好的邻居，不要求最好。</li><li>第一选择爬山：跳到第一个更好的邻居，减少计算量。</li><li>随机重启：搜索到一定程度没有进展后，随机一个初始位置重新开始。</li></ul><h2><a id="模拟退火" href="#模拟退火" class="headerlink" title="模拟退火"></a>模拟退火</h2><p>模拟退火可以看作是爬山算法的一个激进的变种：它不保证跳到比当前更优的状态，而是以一定概率跳到更劣的状态：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">simulated_annealing</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">></span> <span class="token operator">+</span> <span class="token class-name">Cost</span><span class="token operator">></span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token punctuation">,</span> temperature<span class="token punctuation">:</span> <span class="token keyword">impl</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">N</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> cur<span class="token punctuation">:</span> <span class="token class-name">N</span> <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">init_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> te <span class="token operator">=</span> <span class="token function">temperature</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> te <span class="token operator">&lt;=</span> <span class="token number">1e-9</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">let</span> nex <span class="token operator">=</span> p
            <span class="token punctuation">.</span><span class="token function">actions_of</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">random_pick</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> rng<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>a<span class="token closure-punctuation punctuation">|</span></span> cur<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> nex<span class="token punctuation">.</span><span class="token function">is_none</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">let</span> nex <span class="token operator">=</span> nex<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> delta_e <span class="token operator">=</span> nex<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> cur<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> delta_e <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">.</span> <span class="token operator">||</span> rng<span class="token punctuation">.</span><span class="token function">gen_bool</span><span class="token punctuation">(</span><span class="token punctuation">(</span>delta_e <span class="token operator">/</span> te<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            cur <span class="token operator">=</span> nex
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    cur
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2><a id="约束满足问题与最小冲突算法。" href="#约束满足问题与最小冲突算法。" class="headerlink" title="约束满足问题与最小冲突算法。"></a>约束满足问题与最小冲突算法。</h2><p>上述搜索算法对问题的建模是以状态-操作的模式进行的，这里我们考虑另一种形式的建模：Constraint Satisfaction Problem。</p><p>我们有<script type="math/tex">n</script>个变量<script type="math/tex">x_1, \ldots, x_n</script>和<script type="math/tex">m</script>个约束<script type="math/tex">c_1, \ldots, c_m</script>，每个变量有自己的值域。我们要给变量一组赋值使得<script type="math/tex">m</script>个约束均被满足。</p><p>最小冲突算法可以求解约束满足问题（或近似解）。基本思路很简单：对于存在不满足约束（冲突）的变量，我们将其更新为其值域中冲突个数（估价）最小的那个值。如此反复。</p><h2><a id="Minimax-搜索" href="#Minimax-搜索" class="headerlink" title="Minimax 搜索"></a>Minimax 搜索</h2><p>Minimax 搜索常用于解决双人零和博弈问题。</p><p>直观理解是，我们对每个局面有一个估价（1 为先手胜 -1 为先手负）。我们总是希望走到估价最小的后继局面（这代表让对手难以获胜）</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[doc = <span class="token string">" 计算当前局面的估价"</span>]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">minimax_evaluate</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">></span> <span class="token operator">+</span> <span class="token class-name">Cost</span><span class="token operator">></span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">P</span><span class="token punctuation">,</span> node<span class="token punctuation">:</span> <span class="token class-name">N</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> acts <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">actions_of</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> acts<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> node<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> r <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> a <span class="token keyword">in</span> acts <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> nex <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">minimax_evaluate</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> nex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        r <span class="token operator">=</span> <span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    r
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2><a id="Alpha-Beta-剪枝" href="#Alpha-Beta-剪枝" class="headerlink" title="Alpha-Beta 剪枝"></a>Alpha-Beta 剪枝</h2><p>Minimax 搜索中，先取最大值后取最小值的时候，可以发现当内层局面的估价小于当前外层最大值时，将不会对结果产生更新，<br>因此可以直接返回。先取最小值后取最大值同理。</p><p>进一步思考可以发现，这其实就是在搜索的过程中给了一组上下界的限制。</p><p>严谨一点，考虑 minimax 搜索的数学形式：</p><script type="math/tex;mode=display">\begin{aligned}
E(u) &= \max_{u \to v} \{ -E(v) \} \\
     &= \max_{u \to v} \{ - \max_{v \to w} \{ -E(w) \} \}
\end{aligned}</script><p>假设对<script type="math/tex">E(u)</script>的上下界是<script type="math/tex">\alpha_u &lt; E(u) &lt; \beta_u</script>。那么有</p><script type="math/tex;mode=display">\alpha_u &lt; \max_{u \to v} \{ -E(v) \} &lt; \beta_u</script><p>所以只保留上下界之间的部分即可。于是<script type="math/tex">\alpha_u &lt; -E(v) &lt; \beta_u</script>。<br>此外在枚举<script type="math/tex">v'</script>时我们设之前求出的最大值为<script type="math/tex">r</script><br>那么我们当然要求<script type="math/tex">r &lt; -E(v')</script>，不然这个<script type="math/tex">E(v')</script>求出来就不会对答案有更新，<br>即<script type="math/tex">E(v') &lt; -r</script>。因此我们有</p><script type="math/tex;mode=display">-\beta_u &lt; E(v') &lt; \min(-r, -\alpha_u)</script><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">alpha_beta_minimax</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">></span> <span class="token operator">+</span> <span class="token class-name">Cost</span><span class="token operator">></span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">P</span><span class="token punctuation">,</span> node<span class="token punctuation">:</span> <span class="token class-name">N</span><span class="token punctuation">,</span> alpha<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> beta<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> acts <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">actions_of</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> acts<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> node<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> r <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> a <span class="token keyword">in</span> acts <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> nex <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">alpha_beta_minimax</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> nex<span class="token punctuation">,</span> <span class="token operator">-</span>beta<span class="token punctuation">,</span> <span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">-</span>r<span class="token punctuation">,</span> <span class="token operator">-</span>alpha<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> c <span class="token operator">>=</span> beta <span class="token operator">||</span> c <span class="token operator">&lt;=</span> alpha <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> r<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        r <span class="token operator">=</span> <span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    r
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2><a id="Monte-Carlo-树搜索" href="#Monte-Carlo-树搜索" class="headerlink" title="Monte Carlo 树搜索"></a>Monte Carlo 树搜索</h2><p>蒙特卡洛树搜索算法利用随机采样与环境交互，利用探索-利用平衡进行学习。我们先来看一下它的代码框架：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">search</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token class-name">MctsNode</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">>></span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">P</span><span class="token punctuation">,</span> root<span class="token punctuation">:</span> <span class="token class-name">N</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> lim<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">N</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span>lim <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">tree_select</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">default_policy</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">back_up</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> s<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">best_child</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里我们定义了一个新的结点类型：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">MctsNode</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">></span>
<span class="token keyword">where</span>
    <span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token punctuation">,</span>
    <span class="token keyword">Self</span><span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">></span><span class="token punctuation">,</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">expand</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">childs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">parent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">visits</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">win_rate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">P</span><span class="token punctuation">::</span><span class="token class-name">State</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>MCTS 首先按照 exploration-exploitation tradeoff 的权重公式：</p><script type="math/tex;mode=display">\arg\max_{v \to v'} \frac{Q(v')}{N(v')} + c \sqrt{ \frac{2 \ln N(v)}{ N(v)} \frac{N(v)}{N(v')} }</script><p>从根节点开始，从上至下选择值得探索的状态：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">tree_select</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token class-name">MctsNode</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">>></span><span class="token punctuation">(</span>root<span class="token punctuation">:</span> <span class="token class-name">N</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">N</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> v<span class="token punctuation">:</span> <span class="token class-name">N</span> <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token operator">!</span>v<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_terminal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> u<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        v <span class="token operator">=</span> <span class="token function">best_child</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    v
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">best_child</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token class-name">MctsNode</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">>></span><span class="token punctuation">(</span>u<span class="token punctuation">:</span> <span class="token class-name">N</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">N</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>v<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">N</span><span class="token closure-punctuation punctuation">|</span></span> v<span class="token punctuation">.</span><span class="token function">win_rate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> c <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span> <span class="token operator">*</span> u<span class="token punctuation">.</span><span class="token function">visits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ln</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> v<span class="token punctuation">.</span><span class="token function">visits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    u<span class="token punctuation">.</span><span class="token function">childs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg_max</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cloned</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>然后从这个状态出发，进行随机模拟（默认策略）完成一局游戏：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">default_policy</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token operator">></span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">P</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token punctuation">::</span><span class="token class-name">State</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">P</span><span class="token punctuation">::</span><span class="token class-name">State</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> s<span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token operator">!</span>s<span class="token punctuation">.</span><span class="token function">is_terminal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> a <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">actions_of</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">random_pick</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> rng<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">trans</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    s
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后将结果向上传播，更新路径上的结点信息：</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">back_up</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">Problem</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token class-name">MctsNode</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token operator">>></span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token class-name">N</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token punctuation">::</span><span class="token class-name">State</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> maybe_v <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span> maybe_v <span class="token punctuation">&#123;</span>
        v<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        maybe_v <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如此重复。最后搜素到一定程度后，通过 <code class="inline-code">best_child</code> 选择最终确定的决策。此时我们将探索参数置为 0，表示完全依赖我们搜索得到的信息。</p></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2023年4月29日 第2次修订</li><li class="post-history-item">2023年4月29日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/Randomized/Distance/">「随机算法专题」距离与相似度的度量</a></div><div class="prev-post"><a href="/Math/Linear-Algbra/Basis/">线性基学习笔记 </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>