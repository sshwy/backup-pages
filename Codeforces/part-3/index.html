<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="keywords" content=""><meta name="description" content="Sshwy 的个人博客"><meta name="generator" content="Hexo 6.3.0"><title>Codeforces 题目选讲 3 - Sshwy&#39;s Notes</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/ssimple.css?20250423.css"><link rel="stylesheet" href="/iconfont/iconfont.css?20250423.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){window.renderKatex()})</script></head><body><header><div class="header" style="width:100%"><div class="header-inner" style="position:fixed;z-index:20;top:0;left:0"><div class="header-content" style="max-width:1200px;margin:auto"><div class="blog-title"><span class="iconfont icon-menu1" id="menu-button"></span> <a href="/" class="logo header-title">Sshwy&#39;s Notes</a><div class="mobile-search"><input type="text"> <span class="iconfont icon-search mobile-search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div><div class="navbar" id="menu-list"><ul class="menu"><li class="menu-item"><a href="/archives/" class="menu-item-link"><span class="menu-item-icon iconfont icon-work"></span> Archives</a></li><li class="menu-item"><a href="/directory/" class="menu-item-link"><span class="menu-item-icon iconfont icon-folder-close"></span> Directory</a></li><li class="menu-item"><a href="/about/" class="menu-item-link"><span class="menu-item-icon iconfont icon-user"></span> About</a></li><li class="menu-item"><a href="/static/beibishi2023" class="menu-item-link"><span class="menu-item-icon iconfont icon-favorite"></span> NOI 背笔试</a></li></ul></div><div class="search"><input type="text"> <span class="iconfont icon-search search-icon"></span> <span class="iconfont icon-baseline-close-px search-close-icon"></span></div></div></div><div class="search-shadow"></div><div class="search-box"><div class="search-container"><div class="search-container-inner"><div class="search-data-status"><span>Fetching search data...</span></div><div class="search-count"></div><div class="search-result"></div></div></div></div></div></header><main class="main"><article class="post"><div class="post-title"><h1 class="page-title">Codeforces 题目选讲 3</h1></div><div class="post-meta"><div class="post-info"><span class="post-info-item post-time" title="2021年3月25日星期四下午2点39分 (CST+08:00)"><span class="info-icon iconfont icon-time"></span>更新于 2021年3月25日 </span><span class="icon infosep"></span><span class="post-info-item post-wordcount"> <span class="info-icon iconfont icon-text"></span>约 6,147 字</span></div><div class="post-directory"><span class="iconfont icon-folder-close"></span> <a class="directory" href="/directory">Home</a> <a class="directory" href="/directory/"></a> <span class="icon smallarrow"></span> <a class="directory" href="/directory/Codeforces/">Codeforces </a><span class="icon smallarrow"></span> 当前文章</div><hr></div><div class="toc"><h2 class="toc-title"><span class="iconfont icon-explain" style="font-size:1em;padding-right:5px"></span>文章目录</h2><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Minimum-Euler-Cycle"><span class="toc-number">1.</span> <span class="toc-text">Minimum Euler Cycle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Divisor-Paths"><span class="toc-number">2.</span> <span class="toc-text">Divisor Paths</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Strange-Function"><span class="toc-number">3.</span> <span class="toc-text">Strange Function</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Substring-Search"><span class="toc-number">4.</span> <span class="toc-text">Substring Search</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Edge-Weight-Assignment"><span class="toc-number">5.</span> <span class="toc-text">Edge Weight Assignment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nested-Rubber-Bands"><span class="toc-number">6.</span> <span class="toc-text">Nested Rubber Bands</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sergey’s-problem"><span class="toc-number">7.</span> <span class="toc-text">Sergey’s problem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Large-Triangle"><span class="toc-number">8.</span> <span class="toc-text">Large Triangle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Raining-season"><span class="toc-number">9.</span> <span class="toc-text">Raining season</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Chiori-and-Doll-Picking-hard-version"><span class="toc-number">10.</span> <span class="toc-text">Chiori and Doll Picking (hard version)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Make-Symmetrical"><span class="toc-number">11.</span> <span class="toc-text">Make Symmetrical</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Make-Square"><span class="toc-number">12.</span> <span class="toc-text">Make Square</span></a></li></ol></div><hr></div><div class="post-content"><h2><a id="Minimum-Euler-Cycle" href="#Minimum-Euler-Cycle" class="headerlink" title="Minimum Euler Cycle"></a><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1334/problem/D">Minimum Euler Cycle</a></h2><blockquote><p>给你一个有向图<script type="math/tex">K_n=(V,E)</script>。<script type="math/tex">|V|=n</script>。<script type="math/tex">|E|=\{ (u,v) \mid u,v\in E,u\ne v \}</script>（有向边）。你要求出字典序最小的欧拉回路的端点序列。例如<script type="math/tex">n=3</script>时为<script type="math/tex">\{1,2,1,3,2,3,1\}</script>。</p><p>由于输出太大，你只需要输出一个区间<script type="math/tex">[L,R]</script>。</p><p><script type="math/tex">n\le 10^5,R-L\le 10^5</script>。</p></blockquote><p><span class="label">构造</span> <span class="label">贪心</span></p><p>这序列一定是<script type="math/tex">\{ \{1,i&gt;1\},\{2,i&gt;2\},\{3,i&gt;3\},...,\{n,i&gt;n\},1\}</script>。<script type="math/tex">\{1,i&gt;1\}</script>表示<script type="math/tex">\{1,2,1,3,1,4,\cdots,1,n\}</script>。</p><p>于是可以简单地求出了。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/1334/d.cpp">代码</a></p><h2><a id="Divisor-Paths" href="#Divisor-Paths" class="headerlink" title="Divisor Paths"></a><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1334/problem/E">Divisor Paths</a></h2><blockquote><p>给你一个整数<script type="math/tex">D</script>，要构建一个无向图<script type="math/tex">G=(V,E)</script>：<script type="math/tex">V=\{x\mid x|d\}</script>，<script type="math/tex">E=\{(x,y)\mid x&gt;y,y|x,\frac{x}{y}\text{ is prime}\}</script>。设<script type="math/tex">(x,y)</script>（<script type="math/tex">x&gt;y</script>）的边权为<script type="math/tex">w(x,y)=\sum_{d|x}[d\nmid y]</script>。</p><p>现在<script type="math/tex">q</script>次询问<script type="math/tex">u,v</script>两点的最短路径数。</p><p><script type="math/tex">D\le 10^{15},q\le 3\times 10^5,u,v\in V</script>。</p></blockquote><p><span class="label">数学</span> <span class="label">数论</span> <span class="label">盲猜</span></p><p>一条边<script type="math/tex">(x,y)</script>相当于<script type="math/tex">y</script>乘一个质数走到<script type="math/tex">x</script>。</p><p>直觉告诉我们<script type="math/tex">u,v</script>的最短路是<script type="math/tex">u \to \gcd(u,v)\to v</script>的权值。相当于你可以从<script type="math/tex">u</script>开始，除掉一些<script type="math/tex">u</script>比<script type="math/tex">v</script>多的质数，再乘上一些<script type="math/tex">v</script>比<script type="math/tex">u</script>多的质数。也可以发现最短路一定经过<script type="math/tex">\gcd(u,v)</script>。也就是说最短路径数是<script type="math/tex">f\left(\frac{u}{\gcd(u,v)}\right)f\left(\frac{v}{\gcd(u,v)}\right)</script>（两边的路径数只和商有关，因此是一个一元函数）。</p><p>那么最短路的数量，相当于就是你乘（除）质数的顺序。那么我们只关心不同质数间的顺序。这就是个多重组合数。那么<script type="math/tex">f(x)</script>就可以容易地计算了。</p><p>最后，由于<script type="math/tex">u,v</script>是<script type="math/tex">D</script>的约数。因此分解质因数的时候枚举<script type="math/tex">D</script>的质因数即可。</p><p>时间复杂度<script type="math/tex">O(\sqrt{D}+q\log D)</script>。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/1334/e.cpp">代码</a></p><h2><a id="Strange-Function" href="#Strange-Function" class="headerlink" title="Strange Function"></a><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1334/problem/F">Strange Function</a></h2><blockquote><p>对于整数序列<script type="math/tex">a</script>，设<script type="math/tex">f(a)</script>表示<script type="math/tex">a</script>的前缀最大值序列。如<script type="math/tex">f(\{3,1,2,7,7,3,6,7,8\})=\{3,7,8\}</script>。</p><p>给出长度为<script type="math/tex">n</script>的序列<script type="math/tex">a,p</script>和长度为<script type="math/tex">m</script>的序列<script type="math/tex">b</script>。你可以以<script type="math/tex">p_i</script>的代价删掉<script type="math/tex">a_i</script>（代价可能是负的），要求用最小的代价删掉一些数，使得<script type="math/tex">f(a')=b</script>。</p><p><script type="math/tex">n\le 5\times 10^5,1\le a_i\le n,|p_i|\le 10^9, 1\le m\le n, 1\le b_{i-1}&lt;b_i\le n</script>。</p></blockquote><p><span class="label">DP</span> <span class="label">线段树</span></p><p>设<script type="math/tex">f(i,j)</script>表示前<script type="math/tex">i</script>个数的最小代价使得<script type="math/tex">f(a[1,i])=b[1,j]</script>。考虑<script type="math/tex">a_{i+1}</script>：</p><ul><li>若<script type="math/tex">a_{i+1}&lt;b_j</script>。则<script type="math/tex">a_{i+1}</script>可以删也可以不删。因此它的代价贡献是<script type="math/tex">\min(p_{i+1},0)</script>。</li><li>若<script type="math/tex">a_{i+1}=b_j</script>，则<script type="math/tex">a_{i+1}</script>可以删。也可以不删。如果不删的话，会多一种转移：<script type="math/tex">f(i,j-1)\to f(i+1,j)</script>。</li><li>若<script type="math/tex">a_{i+1}&gt;b_j</script>。如果选，那么必须<script type="math/tex">a_{i+1}=b_{j+1}</script>，不然不合法；如果不选（删掉），则代价就是<script type="math/tex">p_{i+1}</script>。</li></ul><p>对第二维建线段树维护 DP 即可。</p><p>时间复杂度<script type="math/tex">O((n+m)\log_2m)</script>。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/1334/f.cpp">代码</a></p><h2><a id="Substring-Search" href="#Substring-Search" class="headerlink" title="Substring Search"></a><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1334/problem/G">Substring Search</a></h2><blockquote><p>给出一个小写字母的一一映射（长度为<script type="math/tex">26</script>的排列）<script type="math/tex">p</script>。规定字符串<script type="math/tex">s</script>和<script type="math/tex">t</script>匹配当且仅当：</p><ol><li><script type="math/tex">|s|=|t|</script>；</li><li><script type="math/tex">\forall 1\le i\le |s|</script>，<script type="math/tex">s_i=t_i</script>或<script type="math/tex">p_{s_i}=t_i</script>。</li></ol><p>现在给出两个串<script type="math/tex">s,t</script>（<script type="math/tex">|s|\le |t|</script>），求出<script type="math/tex">s</script>在<script type="math/tex">t</script>的每个位置是否匹配。输出长度为<script type="math/tex">|t|-|s|+1</script>的 01 串。</p><p><script type="math/tex">|s|\le |t|\le 2\times 10^5</script>。</p></blockquote><p><span class="label">多项式</span> <span class="label">随机</span></p><p><script type="math/tex">s_i=t_i</script>或者<script type="math/tex">p_{s_i}=t_i</script>，等价于<script type="math/tex">(s_i-t_i)^2(p_{s_i}-t_i)^2=0</script>。因此<script type="math/tex">s</script>在<script type="math/tex">i</script>处匹配的条件是</p><script type="math/tex;mode=display">f(i)=\sum_{j=1}^{|s|}(s_j-t_{i+j})^2(p_{s_j}-t_{i+j})^2=0</script><p>那么我们求出<script type="math/tex">f(0),\cdots,f(|t|-|s|)</script>即可。</p><p>如果<script type="math/tex">f</script>是<script type="math/tex">\sum a_ib_{i+j}</script>的形式，我们可以简单地使用<script type="math/tex">O(n\log_2n)</script>多项式乘法计算。而上式实际上可以拆开分成 5 项，分别对应<script type="math/tex">t_{i+j}</script>的 0 到 4 次方项。因此我们对每一项都做多项式乘法最后加起来即可。</p><p>时间复杂度<script type="math/tex">O(n\log_2n)</script>。但这样有一个问题。就是可能被卡 NTT 模数。因此我们给每个字母分配一个随机权值。这样就行了。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/1334/g.cpp">代码</a></p><h2><a id="Edge-Weight-Assignment" href="#Edge-Weight-Assignment" class="headerlink" title="Edge Weight Assignment"></a><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1338/problem/B">Edge Weight Assignment</a></h2><blockquote><p>给出一棵<script type="math/tex">n</script>个点树。你可以给每条边一个边权。要求赋权使得任意两个叶子的路径异或和为<script type="math/tex">0</script>。</p><p>问不同权值个数的最大值和最小值。</p><p><script type="math/tex">3\le n\le 10^5</script>。</p></blockquote><p><span class="label">分类讨论</span> <span class="label">构造</span> <span class="label">手玩</span> <span class="label">DP</span></p><p>题目中的条件可以转化为，选择一个根结点。则任意叶子结点到根的异或和相等。不妨选一个<strong>非叶子结点</strong>作为根。</p><p>考虑最小值。那么容易发现同一个结点<script type="math/tex">u</script>的所有叶子儿子的父边是权值相同的，可以直合并成一个结点。手玩发现，答案是 1 或者 3。3 的构造如下（设<script type="math/tex">a\oplus b\oplus c=0</script>）：</p><p><img src="../../images/codeforces-part-3-1.png" alt="t"></p><p>也可以简单描述一下。考虑从根结点往下构造。设<script type="math/tex">\text{C}(u,a)</script>表示构造<script type="math/tex">u</script>的子树的边权，使得<script type="math/tex">u</script>子树里所有叶子点到<script type="math/tex">u</script>的异或和为<script type="math/tex">a</script>。那么对于<script type="math/tex">C(u,a)</script>，我们给<script type="math/tex">u</script>的叶子儿子的父边赋权为<script type="math/tex">a</script>，然后给<script type="math/tex">u</script>的非叶儿子<script type="math/tex">v</script>的父边赋权为<script type="math/tex">b</script>并递归构造<script type="math/tex">C(v,c)</script>。</p><p>1 的情况很平凡。</p><p>考虑最大值。经过刚才的思考过程，可以发现，两个子树是独立的，可以任意赋权。因此把叶子儿子合并后做一个简单的树形 DP 即可。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/1338/b.cpp">代码</a></p><h2><a id="Nested-Rubber-Bands" href="#Nested-Rubber-Bands" class="headerlink" title="Nested Rubber Bands"></a><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1338/problem/D">Nested Rubber Bands</a></h2><blockquote><p>你有一棵<script type="math/tex">n</script>个点树<script type="math/tex">T=(V,E)</script>。要求你构造平面上<script type="math/tex">n</script>个封闭图形<script type="math/tex">a_i</script>。若<script type="math/tex">a_u</script>和<script type="math/tex">a_v</script>相交（边界相交），当且仅当<script type="math/tex">(u,v)\in E</script>。问这<script type="math/tex">n</script>个封闭图形中至多有多少个互相嵌套的图形。即找一个最大子集<script type="math/tex">S</script>，使得<script type="math/tex">\forall x,y\in S</script>，<script type="math/tex">a_x</script>和<script type="math/tex">a_y</script>是包含关系。输出<script type="math/tex">|S|</script>。</p><p><script type="math/tex">3\le n\le 10^5</script>。</p></blockquote><p><span class="label">DP</span> <span class="label">手玩</span></p><p>考虑这样一个问题：若<script type="math/tex">(x,y)\in E</script>且<script type="math/tex">a_x\subset a_z</script>，那么<script type="math/tex">a_y</script>和<script type="math/tex">a_z</script>是什么关系？</p><p>容易发现，<script type="math/tex">a_y\subset a_z</script>、<script type="math/tex">a_y,a_z</script>相交这两个条件<strong>有且仅有</strong>一个满足。</p><p>我们断言：一个合法的相互嵌套方案是集合<script type="math/tex">S</script>使得：</p><ol><li><script type="math/tex">S</script>中任意两个点不相邻。</li><li>存在树上的一条简单路径<script type="math/tex">P</script>使得<script type="math/tex">S</script>中的点到<script type="math/tex">P</script>的距离小于等于<script type="math/tex">1</script>（毛毛虫）。</li></ol><p>证明：反证法。不妨考虑下图的情况。其他情况可以类比：</p><p><img src="../../images/codeforces-part-3-2.png" alt="t"></p><p>在这里<script type="math/tex">5,6,7</script>是不分顺序的。不妨设<script type="math/tex">a_7\subset a_6\subset a_5</script>。</p><p>那么根据刚才的小发现，<script type="math/tex">4</script>一定在被<script type="math/tex">6</script>包含；于是<script type="math/tex">1</script>也一定被<script type="math/tex">6</script>包含，<script type="math/tex">2</script>也一定被<script type="math/tex">6</script>包含。</p><p>那么<script type="math/tex">a_2\subset a_6\subset a_5</script>，而<script type="math/tex">a_2,a_5</script>是相交的，矛盾。</p><p>而如果不存在上图的方案，可以证明一定是毛毛虫的形式。或者说我们还可以证明，毛毛虫为什么一定合法？</p><p>这个也不难。枚举在末尾加一个子树，看子树的根结点选或者不选。然后都可以构造使得新构造的把之前的都包含了。</p><p>证完后就可以求答案了。可以直接树形 DP 或者换根。</p><p>复杂度<script type="math/tex">O(n)</script>。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/1338/d.cpp">代码</a></p><h2><a id="Sergey’s-problem" href="#Sergey’s-problem" class="headerlink" title="Sergey’s problem"></a><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1019/problem/C">Sergey’s problem</a></h2><blockquote><p>给你一个<script type="math/tex">n</script>个点<script type="math/tex">m</script>条边的有向图（无自环，可能有重边）。要求你求出一个点集<script type="math/tex">Q</script>使得对于任意不在<script type="math/tex">Q</script>中的点<script type="math/tex">u</script>，都存在一个点<script type="math/tex">v\in Q</script>使得<script type="math/tex">v</script>走不超过 2 步可以到<script type="math/tex">u</script>。可以证明一定有解。</p><p><script type="math/tex">n,m\le 10^6</script>。</p></blockquote><p><span class="label">归纳法</span> <span class="label">构造</span></p><p>如果我选了点<script type="math/tex">u</script>，那么<script type="math/tex">u</script>走一步能到的点就不能选。另一方面，如果走一步能到<script type="math/tex">u</script>的某个点<script type="math/tex">v</script>被选了，那么意味着<script type="math/tex">u</script>和<script type="math/tex">u</script>走一步能到的点都被<script type="math/tex">v</script>覆盖了。因此我们可以把<script type="math/tex">u</script>和它走一步能到的点删了，对剩下的图构造。构造完了我们再看是否有走一步能到<script type="math/tex">u</script>的点被选。如果有，就不用选<script type="math/tex">u</script>了。否则就选<script type="math/tex">u</script>。</p><p>写一个 DFS 即可。</p><p>时间复杂度<script type="math/tex">O(n+m)</script>。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/1019/c.cpp">代码</a></p><h2><a id="Large-Triangle" href="#Large-Triangle" class="headerlink" title="Large Triangle"></a><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1019/problem/D">Large Triangle</a></h2><blockquote><p>给你二维平面上<script type="math/tex">n</script>个点，问你是否存在三个点使得三角形面积恰好为<script type="math/tex">S</script>。</p><p><script type="math/tex">3\le n\le 2000,1\le S\le 2\times 10^{18}</script>。</p></blockquote><p><span class="label">微调</span></p><p>如果确定了两个点，那么把它当作一个向量，与其他点算叉积，则可以排序后二分判定。</p><p>但问题是，你选择不同的向量，顺序也不一样。每次排序的话，就是<script type="math/tex">O(n^3\log_2n)</script>的。</p><p>不过考虑一下，如果我只是轻微旋转一下这个向量，那么只有这个向量的两个端点的顺序发生变化，两者交换一下即可。只要我们别旋转到超过下一个向量，则其他的点的顺序也是不变的。</p><p>因此把<script type="math/tex">O(n^2)</script>个向量按斜率排序，然后按序交换并二分即可。时间复杂度<script type="math/tex">O(n^2\log_2n)</script>。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/1019/d.cpp">代码</a></p><h2><a id="Raining-season" href="#Raining-season" class="headerlink" title="Raining season"></a><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1019/problem/E">Raining season</a></h2><blockquote><p>给一棵<script type="math/tex">n</script>个点的树，每条边的权值是一个一次函数<script type="math/tex">a_ix+b_i</script>。给你<script type="math/tex">m</script>，问你在<script type="math/tex">x=0,1,\cdots,m-1</script>时树的直径是多少。输出<script type="math/tex">m</script>个数。</p><p><script type="math/tex">n\le 10^5,m\le 10^6,0\le a_i\le 10^5,0\le b_i\le 10^9</script>。</p></blockquote><p><span class="label">边分治</span> <span class="label">闵可夫斯基和</span> <span class="label">凸包</span> <span class="label">计算几何</span></p><p>一条路径的权值是一次函数。</p><p>则直径的函数是半平面交的形式。</p><p>考虑边分治。首先多叉树转二叉树。</p><p>假设当前的连通块的大小是<script type="math/tex">n</script>，考虑经过当前分治边的直径。显然可以看作是两边各选一个点的一次函数加起来，对这<script type="math/tex">O(n^2)</script>个一次函数求半平面交。但这东西复杂度太大。</p><p>将半平面交对偶成凸包（一次函数对偶成点）。容易发现，两个一次函数的加法，就是两个点（向量）的加法。则两边的一次函数加起来的半平面交，相当于对偶后两边的点加起来的凸包。也就是两边的凸包的闵可夫斯基和。这个可以<script type="math/tex">O(n)</script>做，而且得到的凸包的大小也是<script type="math/tex">O(n)</script>的。</p><p>对于每个连通块我们都做一次，这样会得到总大小为<script type="math/tex">O(n\log_2n)</script>的凸包集合。把这些点全丢一起再求一次凸包（注意是凸包合并，不是闵可夫斯基和），再对偶回去就得到直径的函数了。</p><p>然后求一下<script type="math/tex">0,\cdots,m-1</script>的点值即可。</p><p>时间复杂度<script type="math/tex">O(n\log_2^2n+m)</script>。</p><p>由于一般的闵可夫斯基和太容易出锅，因此代码里写的是两个上凸壳的闵可夫斯基和。这样的好处是不用极角排序，按 x 轴排序也能做。</p><p><a target="_blank" rel="noopener" href="https://gitee.com/sshwy/code/raw/master/codeforces/1019/e.cpp">代码</a></p><h2><a id="Chiori-and-Doll-Picking-hard-version" href="#Chiori-and-Doll-Picking-hard-version" class="headerlink" title="Chiori and Doll Picking (hard version)"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/blog/fuyuki/solution-cf1336e2">Chiori and Doll Picking (hard version)</a></h2><blockquote><p>给出一个非负整数集合<script type="math/tex">A</script>，设</p><script type="math/tex;mode=display">p_i=\sum_{S\subseteq A}\left[ \text{popcount}(\oplus_{x\in S}x)=i \right]</script><p>求<script type="math/tex">p_0,p_1,\cdots,p_m</script>。</p><p><script type="math/tex">n\le 2\times 10^5,m\le 53</script>。</p></blockquote><p><span class="label">线性基</span> <span class="label">meet in middle</span> <span class="label">FWT</span> <span class="label">组合数学</span></p><p>先求出线性基<script type="math/tex">B</script>，设<script type="math/tex">B</script>能表出的数的集合为<script type="math/tex">S(B)</script>。那么答案显然就是线性基的数的答案乘<script type="math/tex">2^{n-|B|}</script>。</p><p>若<script type="math/tex">|B|\le 26</script>，则我们可以暴力枚举<script type="math/tex">S(B)</script>的数并统计答案。</p><p>若<script type="math/tex">|B|&gt;26</script>，构造序列<script type="math/tex">A</script>，<script type="math/tex">A_i=[i\in S(B)]</script>。那么<script type="math/tex">A</script>有一些性质。不妨设<script type="math/tex">A</script>的 FWT 变换为<script type="math/tex">\hat{A}</script>。</p><p>性质 1：<script type="math/tex">\hat{A}_i</script>的取值只能为<script type="math/tex">0</script>或<script type="math/tex">2^{|B|}</script>。</p><p>我们知道<script type="math/tex">\hat{A}_i=\sum_{j}A_j(-1)^{|i\& j|}</script>。而<script type="math/tex">A</script>中值为<script type="math/tex">1</script>的数只有<script type="math/tex">2^{|B|}</script>个，因此若<script type="math/tex">\hat{A}_i=2^{|B|}</script>，则必然满足：<script type="math/tex">\forall j\in S(B)</script>，<script type="math/tex">|i\& j|</script>是偶数。</p><p>那么这样的<script type="math/tex">i</script>一共有多少个？假设满足该条件的<script type="math/tex">i</script>的集合为<script type="math/tex">G</script>。那么容易发现，<script type="math/tex">\forall x,y\in G</script>，<script type="math/tex">x\oplus y\in G</script>，也就是说<script type="math/tex">G</script>有关于异或运算的封闭性。因此可以求出<script type="math/tex">G</script>的一个线性基<script type="math/tex">C</script>。容易发现<script type="math/tex">C</script>的大小是小于等于<script type="math/tex">m-|B|</script>的！因为你确定了<script type="math/tex">B</script>中自由元的值后，根据“偶数条件”，其他主元的值也确定了。</p><p>我们可以使用一些技巧做到<script type="math/tex">2^{m-|B|}</script>枚举<script type="math/tex">G</script>中的数。</p><p>那么我们再考虑 FWT 回去求答案，则</p><script type="math/tex;mode=display">\begin{aligned}
p_x
&=\sum_{i=0}^{2^m-1}[|i|=x]A_i\\
&=\sum_{i=0}^{2^m-1}[|i|=x]\frac{1}{2^m}\sum_{j\in G}\hat{A}_j(-1)^{|i\& j|}\\
&=\frac{1}{2^{m-|B|}}\sum_{j\in G}\sum_{i=0}^{2^m-1}[|i|=x](-1)^{|i\& j|}
\end{aligned}</script><p>容易发现。后面的那个式子只和<script type="math/tex">|j|</script>有关，即<script type="math/tex">\sum_{i}[|i|=x](-1)^{|i\& j|}=g(x,|j|)</script>。那么我们想办法预处理<script type="math/tex">g(x,y)</script>即可。</p><script type="math/tex;mode=display">g(x,y)=\sum_{i=0}^{2^m-1}[|i|=x](-1)^{|i\& (2^y-1)|}=\sum_{z=0}^{\min(x,y)}\binom{y}{z}\binom{m-y}{x-z}(-1)^z</script><p>不妨设<script type="math/tex">f(x)=\sum_{j\in G}[|j|=x]</script>，那么原式可以化为</p><script type="math/tex;mode=display">p_x=\frac{1}{2^{m-|B|}}\sum_{y=0}^{m}f(y)g(x,y)</script><p><a target="_blank" rel="noopener" href="https://codeforces.ml/contest/1336/submission/77343381">代码</a></p><h2><a id="Make-Symmetrical" href="#Make-Symmetrical" class="headerlink" title="Make Symmetrical"></a><a target="_blank" rel="noopener" href="https://codeforces.ml/contest/1028/problem/F">Make Symmetrical</a></h2><blockquote><p>二维平面上，要求支持<script type="math/tex">q</script>次操作：</p><ul><li>插入一个整点<script type="math/tex">(x,y)</script>（<script type="math/tex">1\le x,y\le 10^5</script>），保证这个点之前没有插入过。</li><li>删除一个点（之前插入过）。</li><li>给出<script type="math/tex">(x,y)</script>（<script type="math/tex">1\le x,y\le 10^5</script>），求至少再加入多少个点可以使整个点集关于直线<script type="math/tex">((0,0),(x,y))</script>轴对称。</li></ul><p><script type="math/tex">1\le q\le 2\times 10^5</script>。</p></blockquote><p><span class="label">暴力</span></p><p>关于<script type="math/tex">((0,0),(x,y))</script>轴对称的点，到原点的距离是相等的。而实际上满足<script type="math/tex">x^2+y^2=C</script>在固定<script type="math/tex">C</script>的情况下的点<script type="math/tex">(x,y)</script>的数量是不多的。在本题中至多有<script type="math/tex">144</script>个点。</p><p>不妨考虑，每次加入一个点的时候，我们<script type="math/tex">O(144)</script>地更新答案。然后查询的时候直接查表即可。</p><p>值得一提的是，在计算两个点的对称轴的时候由于这两个点到原点的距离相等，因此可以直接向量加法求出（菱形）。</p><p>用 map 维护。时间复杂度<script type="math/tex">O(q\log_2n\cdot 144))</script>，使用 unordered_map 可以更快。</p><p><a target="_blank" rel="noopener" href="https://codeforces.ml/contest/1028/submission/77597293">代码</a></p><h2><a id="Make-Square" href="#Make-Square" class="headerlink" title="Make Square"></a><a target="_blank" rel="noopener" href="https://codeforces.ml/contest/1028/problem/H">Make Square</a></h2><blockquote><p>如果序列<script type="math/tex">b_1,\cdots,b_m</script>中存在两个数<script type="math/tex">b_i,b_j</script>（<script type="math/tex">i&lt;j</script>）使得<script type="math/tex">b_ib_j</script>是完全平方数，则<script type="math/tex">b</script>是好的。</p><p>对于一个序列<script type="math/tex">b</script>，每次操作，你可以选择一个元素并乘上一个质数，或者选择一个元素并除掉一个质数。<script type="math/tex">f(b)</script>表示最少的操作次数使得<script type="math/tex">b</script>变成好的。</p><p>给你一个序列<script type="math/tex">a</script>，每次询问区间的<script type="math/tex">f(a[l,r])</script>。</p><p><script type="math/tex">n\le 2\times 10^5,q\le 10^6,a_i\le 5\times 10^6</script>。</p></blockquote><p><span class="label">DP</span> <span class="label">二进制表示</span> <span class="label">异或</span> <span class="label">扫描</span></p><p>首先想到把平凡因子去掉，这样每个数就最多有<script type="math/tex">7</script>个互不相同的质因子，即最多有<script type="math/tex">128</script>个约数。</p><p>现在，要让<script type="math/tex">ab</script>是完全平方数（即<script type="math/tex">a</script>到<script type="math/tex">b</script>的最短距离），则相当于<script type="math/tex">a</script>要先走到<script type="math/tex">a</script>的某个约数<script type="math/tex">x</script>，再从<script type="math/tex">x</script>走到<script type="math/tex">b</script>。</p><p>考虑扫描线 DP。考虑<script type="math/tex">a_1,\cdots,a_i</script>，设<script type="math/tex">f(x,d)</script>表示最大的<script type="math/tex">j</script>（<script type="math/tex">j\le i</script>）使得<script type="math/tex">x\mid a_j</script>且<script type="math/tex">\frac{a_j}{x}</script>有<script type="math/tex">d</script>个质因子（即<script type="math/tex">x</script>走<script type="math/tex">d</script>步到<script type="math/tex">a_j</script>）。再设<script type="math/tex">g_x</script>表示最大（靠右）的<script type="math/tex">j</script>使得<script type="math/tex">[j,i]</script>的答案<script type="math/tex">\le x</script>。</p><p>考虑如何从<script type="math/tex">i-1</script>更新到<script type="math/tex">i</script>。加入一个<script type="math/tex">a_i</script>，则我们可以先枚举<script type="math/tex">x\mid a_i</script>，用<script type="math/tex">a_i</script>走到<script type="math/tex">x</script>再走<script type="math/tex">d</script>步来更新对应的<script type="math/tex">g</script>（即使<script type="math/tex">a_i</script>到<script type="math/tex">x</script>和<script type="math/tex">x</script>走的<script type="math/tex">d</script>步中有相同的质因数也没关系。因为我们求的是<script type="math/tex">\le</script>）。更新完<script type="math/tex">g</script>再用<script type="math/tex">x</script>走到<script type="math/tex">a_i</script>来更新<script type="math/tex">f</script>。</p><p>然后我们就可以求出以<script type="math/tex">i</script>为右端点的询问的答案了。</p><p>时间复杂度<script type="math/tex">O(n(\sqrt{a_i}+128\cdot 7)+q\cdot 14)</script>。</p><p><a target="_blank" rel="noopener" href="https://codeforces.ml/contest/1028/submission/77600817">代码</a></p></div><hr><h3><span class="iconfont icon-history" style="padding-right:5px;font-size:1em"></span>修订记录</h3><div class="post-history-list"><ol reversed><li class="post-history-item">2021年3月25日 第3次修订</li><li class="post-history-item">2021年2月11日 第2次修订</li><li class="post-history-item">2020年4月24日 创建文章</li></ol></div><div class="post-footer"><hr><div class="next-post"><span class="iconfont icon-arrow-left-circle"></span> <a href="/Probset/21-March-1/">2021 省选三轮跟训日志 1</a></div><div class="prev-post"><a href="/Math/Counting-Pro/">「草稿」组合计数综合练习 </a><span class="iconfont icon-arrow-right-circle"></span></div></div></article></main></body><div class="side-button"><div id="comment-button" class="button" title="Valine Comment"><span class="iconfont icon-comment"></span></div><div id="darkmode-button" class="button" title="Switch between day and night"><span class="iconfont icon-moonbyueliang"></span></div><div id="top" class="button" title="Back to top"><span class="iconfont icon-arrowup"></span></div></div><footer id="footer" style="margin:3em 0 2em 0;text-align:center;line-height:1.4em"><span class="post-wordcount iconfont icon-text"></span> 全站约 404,069 字<div class="license" style="padding:0 10px"><span>本站所有文章遵循许可协议 <a target="_blank" rel="license noreferrer noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></span></div><div class="credit"><span>Themed <a href="https://github.com/sshwy/hexo-theme-essence" target="_blank" rel="noreferrer noopener">Essence v1.9.11</a> | Powered by <a href="http://hexo.io" target="_blank" rel="noreferrer noopener">Hexo</a></span></div><div class="friends"><span class="friend-link-span">友情链接 </span><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://carol-xrl.github.io/"><span class="friend-link-span">Carol </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GavinZheng"><span class="friend-link-span">GavinZheng </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xryjr233"><span class="friend-link-span">xryjr233 </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314"><span class="friend-link-span" title="为什么我的头常常变绿？因为…… "><span style="font-weight:700"><span class="codeforces p">dy</span><span class="codeforces m">syn</span><span class="codeforces p">1314</span></span> </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://blog.aor.sd.cn"><span class="friend-link-span">RainAir </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lcyfrog"><span class="friend-link-span">lcyfrog </span></a><span class="icon friendsep"></span> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maoyiting"><span class="friend-link-span">/hanx/se</span></a></div><div class="copyright"><span>Copyright &copy; 2019-present - Sshwy</span></div></footer><script src="/js/ssimple.js?20250423.js"></script><script src="https://pv.sohu.com/cityjson?ie=utf-8.js" defer></script></html>